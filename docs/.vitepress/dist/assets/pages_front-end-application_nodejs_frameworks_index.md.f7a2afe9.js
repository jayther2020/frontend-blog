import{_ as n,c as a,o as l,a as p}from"./app.d773c0a6.js";const o="/frontend-blog/assets/image-20220525092814117-16534420971171.e9da2c55.png",e="/frontend-blog/assets/image-20220919230529954.d9d30d53.png",c="/frontend-blog/assets/image-20220525193234452.918d8082.png",t="/frontend-blog/assets/image-20220913164504391.01cd1cdd.png",r="/frontend-blog/assets/image-20220913163022685.4c8ab0f8.png",F="/frontend-blog/assets/image-20220913164746867.6e856469.png",D="/frontend-blog/assets/image-20220525193352485.7c56b78d.png",y="/frontend-blog/assets/image-20220525193759431.74691a99.png",A="/frontend-blog/assets/image-20220525194345288.45861631.png",C="/frontend-blog/assets/image-20220525200025102.0552d94d.png",s="/frontend-blog/assets/image-20220525211813419.1616f604.png",i="/frontend-blog/assets/image-20220525211856834.4727295f.png",d="/frontend-blog/assets/image-20220525213631711.bdf55cca.png",j=JSON.parse('{"title":"Nodejs\u6846\u67B6","description":"","frontmatter":{},"headers":[{"level":2,"title":"Express","slug":"express","link":"#express","children":[{"level":3,"title":"\u670D\u52A1\u5668\u521D\u6B65","slug":"\u670D\u52A1\u5668\u521D\u6B65","link":"#\u670D\u52A1\u5668\u521D\u6B65","children":[]},{"level":3,"title":"\u8DEF\u7531","slug":"\u8DEF\u7531","link":"#\u8DEF\u7531","children":[]},{"level":3,"title":"\u4E2D\u95F4\u4EF6","slug":"\u4E2D\u95F4\u4EF6","link":"#\u4E2D\u95F4\u4EF6","children":[]}]},{"level":2,"title":"Koa","slug":"koa","link":"#koa","children":[{"level":3,"title":"\u4E2D\u95F4\u4EF6","slug":"\u4E2D\u95F4\u4EF6-1","link":"#\u4E2D\u95F4\u4EF6-1","children":[]}]},{"level":2,"title":"\u8DE8\u57DF\u8BF7\u6C42","slug":"\u8DE8\u57DF\u8BF7\u6C42","link":"#\u8DE8\u57DF\u8BF7\u6C42","children":[{"level":3,"title":"CORS","slug":"cors","link":"#cors","children":[]},{"level":3,"title":"JSONP","slug":"jsonp","link":"#jsonp","children":[]},{"level":3,"title":"JWT","slug":"jwt","link":"#jwt","children":[]}]},{"level":2,"title":"\u6570\u636E\u5E93\u94FE\u63A5","slug":"\u6570\u636E\u5E93\u94FE\u63A5","link":"#\u6570\u636E\u5E93\u94FE\u63A5","children":[{"level":3,"title":"\u6570\u636E\u5E93\u7BA1\u7406\u754C\u9762","slug":"\u6570\u636E\u5E93\u7BA1\u7406\u754C\u9762","link":"#\u6570\u636E\u5E93\u7BA1\u7406\u754C\u9762","children":[]},{"level":3,"title":"\u7CFB\u7EDF\u6570\u636E\u5E93","slug":"\u7CFB\u7EDF\u6570\u636E\u5E93","link":"#\u7CFB\u7EDF\u6570\u636E\u5E93","children":[]},{"level":3,"title":"\u6570\u636E\u5E93\u5904\u7406","slug":"\u6570\u636E\u5E93\u5904\u7406","link":"#\u6570\u636E\u5E93\u5904\u7406","children":[]},{"level":3,"title":"\u94FE\u63A5\u6570\u636E\u5E93","slug":"\u94FE\u63A5\u6570\u636E\u5E93","link":"#\u94FE\u63A5\u6570\u636E\u5E93","children":[]},{"level":3,"title":"\u5C01\u88C5MySql\u5E93","slug":"\u5C01\u88C5mysql\u5E93","link":"#\u5C01\u88C5mysql\u5E93","children":[]}]},{"level":2,"title":"\u4E09\u5C42\u4F53\u7CFB\u67B6\u6784","slug":"\u4E09\u5C42\u4F53\u7CFB\u67B6\u6784","link":"#\u4E09\u5C42\u4F53\u7CFB\u67B6\u6784","children":[]}],"relativePath":"pages/front-end-application/nodejs/frameworks/index.md"}'),u={name:"pages/front-end-application/nodejs/frameworks/index.md"},g=p(`<h1 id="nodejs\u6846\u67B6" tabindex="-1">Nodejs\u6846\u67B6 <a class="header-anchor" href="#nodejs\u6846\u67B6" aria-hidden="true">#</a></h1><h2 id="express" tabindex="-1">Express <a class="header-anchor" href="#express" aria-hidden="true">#</a></h2><h3 id="\u670D\u52A1\u5668\u521D\u6B65" tabindex="-1">\u670D\u52A1\u5668\u521D\u6B65 <a class="header-anchor" href="#\u670D\u52A1\u5668\u521D\u6B65" aria-hidden="true">#</a></h3><h4 id="\u521B\u5EFA" tabindex="-1">\u521B\u5EFA <a class="header-anchor" href="#\u521B\u5EFA" aria-hidden="true">#</a></h4><blockquote><p>\u76F8\u8F83\u4E0A\u9762\u7684http\u5E93\uFF0C\u6709\u4E00\u79CD\u66F4\u9002\u5408\u5236\u4F5C\u670D\u52A1\u5668\u7684\u5E93\uFF0C\u5373Express\u3002</p><p>\u5EFA\u7ACB\u4E00\u4E2A\u670D\u52A1\u5668\uFF0C\u8DDF\u4E4B\u524D\u5B66\u7684http\u5E93\u5DEE\u4E0D\u591A\uFF0C\u90FD\u7ECF\u8FC7\u4EE5\u4E0B\u64CD\u4F5C\uFF1A</p><ol><li>\u5F15\u5165</li><li>\u65B0\u5EFA\u5B9E\u4F8B</li><li>\u76D1\u542C\u54CD\u5E94</li></ol></blockquote><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> express </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">express</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">3000</span><span style="color:#89DDFF;">,()</span><span style="color:#C792EA;">=&gt;</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">server successfully running at http://localhost:3000</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h4 id="\u76D1\u542Cget\u548Cpost\u8BF7\u6C42" tabindex="-1">\u76D1\u542CGET\u548CPOST\u8BF7\u6C42 <a class="header-anchor" href="#\u76D1\u542Cget\u548Cpost\u8BF7\u6C42" aria-hidden="true">#</a></h4><blockquote><p>\u7528\u5B9E\u4F8B\u7684get\u3001post\u65B9\u6CD5\u76D1\u542C\u5E76\u54CD\u5E94</p><p>get\u51FD\u6570\uFF1A<code>app.get(route,(req,res)=&gt;{})</code></p><p>post\u51FD\u6570\uFF1A<code>app.post(route,(req,res)=&gt;{})</code></p></blockquote><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> server </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">express</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#676E95;">///////////\u76D1\u542CGET\u8BF7\u6C42////////////</span></span>
<span class="line"><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/abc</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;">=&gt;</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">a</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;">b</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;">c</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;">///////////\u76D1\u542CPOST\u8BF7\u6C42///////////</span></span>
<span class="line"><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/abc</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;">=&gt;</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">congratulations!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h4 id="\u6307\u5B9A\u9759\u6001\u8D44\u6E90" tabindex="-1">\u6307\u5B9A\u9759\u6001\u8D44\u6E90 <a class="header-anchor" href="#\u6307\u5B9A\u9759\u6001\u8D44\u6E90" aria-hidden="true">#</a></h4><blockquote><p>1</p></blockquote><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="\u8DEF\u7531" tabindex="-1">\u8DEF\u7531 <a class="header-anchor" href="#\u8DEF\u7531" aria-hidden="true">#</a></h3><h4 id="\u8DEF\u7531\u6587\u4EF6\u6A21\u5757" tabindex="-1">\u8DEF\u7531\u6587\u4EF6\u6A21\u5757 <a class="header-anchor" href="#\u8DEF\u7531\u6587\u4EF6\u6A21\u5757" aria-hidden="true">#</a></h4><blockquote><p>\u8DEF\u7531\u53EF\u4EE5\u50CF\u4E0A\u9762\u76D1\u542C\u6307\u5B9Aurl\u7684\u65B9\u6CD5\u505A\u8DEF\u7531\uFF0C\u53EF\u66F4\u591A\u8FD8\u662F\u628A\u5B83\u4EEC\u5212\u5206\u4E3A\u6A21\u5757\uFF0C\u5206\u6563\u5230\u6587\u4EF6\u53BB\u3002</p><p>\u4E3B\u6587\u4EF6\u53EA\u9700\u8981\u5F15\u5165\u5E76\u4F7F\u7528\u5BF9\u5E94\u6A21\u5757\u5373\u53EF</p></blockquote><p><code>router.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> express </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> router </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> express</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Router</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pokedex</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">}\`</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">get user name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">}\`</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">add new user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> router</span></span>
<span class="line"></span></code></pre></div><p><code>index.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> someRouter </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./router.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(someRouter)</span></span>
<span class="line"></span></code></pre></div><blockquote><p>\u5185\u5BB9\u7C7B\u578B\uFF1A\u5982\u679C\u662Fpost\u8BF7\u6C42\u5FC5\u987B\u6307\u5B9A\u8FD9\u4E2A\u5C5E\u6027:</p><p><code>res.header(&#39;Content-Type&#39;, &#39;application/json;charset=utf-8&#39;)</code></p></blockquote><h3 id="\u4E2D\u95F4\u4EF6" tabindex="-1">\u4E2D\u95F4\u4EF6 <a class="header-anchor" href="#\u4E2D\u95F4\u4EF6" aria-hidden="true">#</a></h3><blockquote><p>Express \u4E2D\u95F4\u4EF6\u662F\u4E00\u4E2A\u51FD\u6570\uFF0C\u5B83\u63A5\u6536\u8BF7\u6C42\u5BF9\u8C61\u3001\u54CD\u5E94\u5BF9\u8C61\u548C next \u51FD\u6570\uFF0C\u5E76\u5728\u8BF7\u6C42-\u54CD\u5E94\u5468\u671F\u7684\u67D0\u4E2A\u70B9\u4E0A\u5BF9\u5B83\u4EEC\u8FDB\u884C\u4FEE\u6539\u3001\u9A8C\u8BC1\u6216\u5176\u4ED6\u64CD\u4F5C\u3002\u901A\u8FC7\u5C06\u4E2D\u95F4\u4EF6\u6302\u8F7D\u5230 Express \u5E94\u7528\u4E2D\uFF0C\u4F60\u53EF\u4EE5\u8F7B\u677E\u5B9E\u73B0\u5168\u5C40\u7684\u9A8C\u8BC1\u3001\u8BB0\u5F55\u3001\u4FEE\u6539\u8BF7\u6C42\u6570\u636E\u3001\u6DFB\u52A0 HTTP \u5934\u4EE5\u53CA\u6267\u884C\u5176\u4ED6\u64CD\u4F5C\u3002</p></blockquote><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> myMiddleware </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// Validate request data</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">username</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">status</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">400</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> error</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Missing username</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// Log request data</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Received request data:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// Modify request data</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">username</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">username</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toLowerCase</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// Add HTTP header</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">X-Powered-By</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">MyMiddleware</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// Call next middleware or route handler</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(express</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#A6ACCD;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(myMiddleware)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/api/users</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// Use modified request data</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">Hello, </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">username</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">!</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><blockquote><p>\u5728 Express \u5E94\u7528\u4E2D\u4F7F\u7528\u4E2D\u95F4\u4EF6\u7684\u65B9\u5F0F\u662F\u901A\u8FC7\u4F7F\u7528 app.use() \u65B9\u6CD5\u6302\u8F7D\u5B83\u4EEC\u3002</p><p>\u5728 app.use() \u4E2D\uFF0C\u4F60\u53EF\u4EE5\u4F20\u9012\u4E00\u4E2A\u8DEF\u5F84\u5B57\u7B26\u4E32\uFF0C\u4EE5\u9650\u5236\u8BE5\u4E2D\u95F4\u4EF6\u4EC5\u5728\u8BE5\u8DEF\u5F84\u8BF7\u6C42\u4E2D\u751F\u6548\u3002</p><p>\u6BD4\u5982\u6302\u8F7D\u5230 &#39;/&#39; \u8DEF\u5F84\u4E0A\u3002\u6240\u6709\u8BF7\u6C42 / \u8DEF\u5F84\u7684\u8BF7\u6C42\u5C06\u7ECF\u8FC7 myMiddleware \u4E2D\u95F4\u4EF6\u3002</p></blockquote><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> express </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">express</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> myMiddleware </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// your middleware logic</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> myMiddleware)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">3000</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Server is running on http://localhost:3000</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h2 id="koa" tabindex="-1">Koa <a class="header-anchor" href="#koa" aria-hidden="true">#</a></h2><h3 id="\u4E2D\u95F4\u4EF6-1" tabindex="-1">\u4E2D\u95F4\u4EF6 <a class="header-anchor" href="#\u4E2D\u95F4\u4EF6-1" aria-hidden="true">#</a></h3><blockquote><p>Koa\u7684\u6D0B\u8471\u539F\u7406\uFF1A\u4E3B\u8981\u662F\u57FA\u4E8E\u5176\u72EC\u7279\u7684\u4E2D\u95F4\u4EF6\u5904\u7406\u673A\u5236\u3002</p><p>\u8FD9\u79CD\u673A\u5236\u501F\u9274\u4E86\u51FD\u6570\u5F0F\u7F16\u7A0B\u4E2D\u7684compose\u601D\u60F3\uFF0C\u4F7F\u5F97\u6BCF\u4E2A\u4E2D\u95F4\u4EF6\u51FD\u6570\u90FD\u80FD\u6309\u7167\u7279\u5B9A\u7684\u987A\u5E8F\u6267\u884C\uFF0C\u4ECE\u800C\u5B9E\u73B0\u5BF9\u8BF7\u6C42\u548C\u54CD\u5E94\u7684\u5904\u7406\u3002</p></blockquote><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// \u8DEF\u7531\u7EDF\u4E00\u540E\u7EED\u4E2D\u95F4\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">3</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">2</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h2 id="\u8DE8\u57DF\u8BF7\u6C42" tabindex="-1">\u8DE8\u57DF\u8BF7\u6C42 <a class="header-anchor" href="#\u8DE8\u57DF\u8BF7\u6C42" aria-hidden="true">#</a></h2><blockquote><p>\u6709\u4E24\u79CD\u65B9\u5F0F\u89E3\u51B3\uFF1A</p><ol><li>CORS\uFF1A\u53EF\u5904\u7406GET,POST\u8BF7\u6C42</li><li>JSONP\uFF1A\u53EA\u53EF\u5904\u7406GET\u8BF7\u6C42</li></ol></blockquote><h3 id="cors" tabindex="-1">CORS <a class="header-anchor" href="#cors" aria-hidden="true">#</a></h3><blockquote><p>\u603B\u5171\u5206\u4E3A\u4E24\u6B65\uFF1A</p><ol><li>\u5F15\u5165cors\u5305\uFF1A<code>const cors = require(&#39;cors&#39;)</code></li><li>\u5B9E\u4F8B\u4F7F\u7528cors\uFF1A<code>app.use(cors())</code></li></ol></blockquote><p><strong>CORS\u53EF\u4EE5\u643A\u5E26\u7684\u4E09\u4E2A\u5B57\u6BB5</strong></p><blockquote><ol><li><p><code>res.header(&#39;Access-Control-Allow-Origin&#39;, &#39;*&#39;)</code></p><p>Access-Control-Allow-Origin\u6709\u4E24\u79CD\u9009\u9879\uFF1A\u4E00\u662F\u5177\u4F53\u5730\u5740\uFF0C\u4E8C\u662F\u4EE3\u8868\u5168\u4F53\u5730\u5740\u7684<code>*</code></p></li><li><p><code>res.header(&quot;Access-Control-Allow-Headers&quot;, &quot; Origin, X-Requested-With, Content-Type, Accept&quot;);</code>\u5BF9\u989D\u5916\u8BF7\u6C42\u5934\u8FDB\u884C\u58F0\u660E</p></li><li><p><code>res.header(&#39;Access-Control-Allow-Methods&#39;, &#39;*&#39;)</code></p><p>\u7531\u6B64\u8BBE\u7F6E\u5141\u8BB8\u66F4\u591A\u7684\u8BF7\u6C42\u65B9\u5F0F\uFF08\u9ED8\u8BA4\u53EA\u652F\u6301GET\u3001POST\u3001HEAD\uFF09\u3002</p></li></ol></blockquote><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">request</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">//\u5141\u8BB8\u6240\u6709\u6765\u6E90\u8BBF\u95EE</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">header</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Access-Control-Allow-Origin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">//\u7528\u4E8E\u5224\u65ADrequest\u6765\u81EAajax\u8FD8\u662F\u4F20\u7EDF\u8BF7\u6C42</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">header</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Access-Control-Allow-Headers</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> Origin, X-Requested-With, Content-Type, Accept</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">//\u5141\u8BB8\u8BBF\u95EE\u7684\u65B9\u5F0F</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">header</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Access-Control-Allow-Methods</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">PUT,POST,GET,DELETE,OPTIONS</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">//\u4FEE\u6539\u7A0B\u5E8F\u4FE1\u606F\u4E0E\u7248\u672C</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">header</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">X-Powered-By</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> 3.2.1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">//\u5185\u5BB9\u7C7B\u578B\uFF1A\u5982\u679C\u662Fpost\u8BF7\u6C42\u5FC5\u987B\u6307\u5B9A\u8FD9\u4E2A\u5C5E\u6027</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">header</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Content-Type</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">application/json;charset=utf-8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">//...</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="jsonp" tabindex="-1">JSONP <a class="header-anchor" href="#jsonp" aria-hidden="true">#</a></h3><blockquote><p>JSONP(JSON with Padding) \u662F\u4E00\u79CD\u501F\u52A9\u4E8E <code>&lt;script&gt;</code> \u6807\u7B7E\u5B9E\u73B0\u8DE8\u57DF\u83B7\u53D6\u6570\u636E\u7684\u65B9\u5F0F,\u7528\u4E8E\u89E3\u51B3\u6D4F\u89C8\u5668\u7684\u540C\u6E90\u7B56\u7565\u7684\u9650\u5236\u3002</p><p>\u6D4F\u89C8\u5668\u7AEF\u901A\u8FC7<code>&lt;script&gt;</code>\u6807\u7B7E\u7684src\u5C5E\u6027\uFF0C\u8BF7\u6C42\u670D\u52A1\u5668\u4E0A\u7684\u6570\u636E\uFF0C\u540C\u65F6\uFF0C\u670D\u52A1\u5668\u8FD4\u56DE\u4E00\u4E2A\u51FD\u6570\u7684\u8C03\u7528\u3002\u8FD9\u79CD\u8BF7\u6C42\u6570\u636E\u7684\u65B9\u5F0F\u53EB\u505AJSONP\u3002</p><p>\u7279\u70B9\uFF1A \u2460JSONP\u4E0D\u5C5E\u4E8E\u771F\u6B63\u7684Ajax\u8BF7\u6C42\uFF0C\u56E0\u4E3A\u5B83\u6CA1\u6709\u4F7F\u7528XMLHttpRequest\u8FD9\u4E2A\u5BF9\u8C61\u3002 \u2461JSONP\u4EC5\u652F\u6301GET\u8BF7\u6C42\uFF0C\u4E0D\u652F\u6301POST\u3001PUT\u3001DELETE\u7B49\u8BF7\u6C42\u3002</p></blockquote><p><code>\u540E\u7AEF\u90E8\u5206</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> express </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">express</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/jsonp</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">callback</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">query</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">John</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> age</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">30</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5C06\u6570\u636E\u4F5C\u4E3A\u53C2\u6570\u4F20\u9012\u7ED9\u56DE\u8C03\u51FD\u6570</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">jsonpStr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`\${</span><span style="color:#A6ACCD;">callback</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">(</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#A6ACCD;">(data)</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">)</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u8BBE\u7F6E\u54CD\u5E94\u7C7B\u578B\u4E3A JS</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">type</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">application/javascript</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">jsonpStr</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">3000</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Server is running on port 3000</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p><code>\u524D\u7AEF\u90E8\u5206</code></p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#F07178;">DOCTYPE</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">JSONP Demo</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">  &lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">handleResponse</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Received data:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> script </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createElement</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">script</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    script</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">http://localhost:3000/jsonp?callback=handleResponse</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    document</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">appendChild</span><span style="color:#A6ACCD;">(script)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><h3 id="jwt" tabindex="-1">JWT <a class="header-anchor" href="#jwt" aria-hidden="true">#</a></h3><blockquote><p>JWT\u662F\u4E00\u79CD\u5F00\u653E\u6807\u51C6(RFC 7519),\u5B83\u5B9A\u4E49\u4E86\u4E00\u79CD\u7D27\u51D1\u4E14\u72EC\u7ACB\u7684\u65B9\u5F0F,\u7528\u4E8E\u5728\u5404\u65B9\u4E4B\u95F4\u5B89\u5168\u5730\u4F20\u8F93JSON\u5BF9\u8C61\u3002</p><p>JWT\u901A\u5E38\u7528\u4E8E\u5728\u5BA2\u6237\u7AEF\u548C\u670D\u52A1\u5668\u4E4B\u95F4\u4F20\u9012\u88AB\u52A0\u5BC6\u7684\u7528\u6237\u8EAB\u4EFD\u9A8C\u8BC1\u4FE1\u606F\u6216\u5176\u4ED6\u58F0\u660E\u3002</p><p>JWT\u7684\u4F18\u70B9\u5305\u62EC:</p><ul><li>\u65E0\u72B6\u6001\u6027,\u670D\u52A1\u5668\u65E0\u9700\u5B58\u50A8\u4F1A\u8BDD\u4FE1\u606F,\u51CF\u8F7B\u670D\u52A1\u5668\u538B\u529B</li><li>\u8DE8\u57DF\u652F\u6301,\u53EF\u8DE8\u57DF\u643A\u5E26Token\u8BBF\u95EE\u8D44\u6E90</li><li>\u652F\u6301\u5206\u5E03\u5F0F\u5E94\u7528,\u4E0D\u540C\u670D\u52A1\u5668\u53EF\u5171\u4EAB\u540C\u4E00\u4E2AToken\u6821\u9A8C</li></ul><p>\u7F3A\u70B9\u5305\u62EC:</p><ul><li>Token\u7684\u7B7E\u540D\u88AB\u7834\u89E3\u540E,\u6240\u6709Token\u90FD\u4F1A\u5931\u6548,\u65E0\u5355\u70B9\u5931\u6548</li><li>\u4E00\u65E6\u7B7E\u53D1\u96BE\u4EE5\u4F5C\u5E9F,\u6240\u4EE5\u4E00\u822C\u4F1A\u8BBE\u7F6E\u8F83\u77ED\u7684\u6709\u6548\u671F</li><li>\u8F83\u957F\u7684Token\u4F1A\u589E\u52A0\u4F20\u8F93\u6210\u672C</li></ul></blockquote><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> jwt </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">jsonwebtoken</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> token </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> jwt</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sign</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">userId</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> user</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">role</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> user</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">role </span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> secretKey</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">expiresIn</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">1h</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">koaJwt</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">secret</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> secretKey</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u9519\u8BEF\u5904\u7406\u7A0B\u5E8F</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// \u7528\u4E8E\u8986\u76D6\u539F\u5148\u7684401\u9519\u8BEF\u7A0B\u5E8F</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#F78C6C;">401</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">err</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">401</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">401</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">\u4F60\u5C1A\u672A\u767B\u5F55\u6216\u767B\u5F55\u5931\u6548\uFF0C\u65E0\u6743\u9650\u8BBF\u95EE\u5F53\u524D\u8D44\u6E90\u3002</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"></span></code></pre></div><h2 id="\u6570\u636E\u5E93\u94FE\u63A5" tabindex="-1">\u6570\u636E\u5E93\u94FE\u63A5 <a class="header-anchor" href="#\u6570\u636E\u5E93\u94FE\u63A5" aria-hidden="true">#</a></h2><p>\u8FD9\u6B21\u4EE5nodejs\u94FE\u63A5MySql\u4E3A\u4F8B\u8FDB\u884C\u5C55\u5F00\u3002</p><blockquote><p>MySQL\u7531\u745E\u5178MySQL AB\u516C\u53F8\u5F00\u53D1\uFF0C2008\u5E74\u88ABSUN\u516C\u53F8\u6536\u8D2D\uFF0C2009\u5E74SUN\u88ABOracle\u6536\u8D2D\u4E86\u3002</p><p>\u5BA2\u6237\u7AEF\u5DE5\u5177\uFF1AMySQL Workbech\uFF08MySQL\u5B98\u65B9\u81EA\u5E26\uFF09\u3001Navicat Premium\u3001PhpMyAdmin\u3001SQLyog\u7B49\u3002</p><p>MySQL\u7684\u5B89\u88C5\u6709\u89E3\u538B\u7248.ZIP\u548C\u5B89\u88C5\u7248.MSI\u3002</p></blockquote><p>\u76F8\u5173\u64CD\u4F5C\u5982\u4E0B\uFF1A</p><blockquote><p><strong>\u5B89\u88C5MySQL\u670D\u52A1</strong>\uFF1AC:\\WINDOWS\\system32&gt;<code>mysqld -install</code></p><p>\u6210\u529F\u63D0\u793A\uFF1AService successfully installed.</p><p><strong>\u542F\u52A8MySQL\u670D\u52A1</strong>\uFF1AC:\\WINDOWS\\system32&gt;<code>net start mysql</code></p><p><strong>\u5220\u9664MySQL\u670D\u52A1</strong>\uFF1AC:\\WINDOWS\\system32&gt;<code>sc delete mysql</code></p><p>\u6210\u529F\u63D0\u793A\uFF1A[SC] DeleteService \u6210\u529F</p></blockquote><p><strong>\u4FEE\u6539\u7AEF\u53E3</strong></p><blockquote><p>\u9ED8\u8BA4\u7AEF\u53E3\uFF1A<code>3306</code></p><p>\u6211\u4EEC\u53EF\u901A\u8FC7\u4FEE\u6539my.ini\u6587\u4EF6\u4E2D<code>port</code>\u503C\u53EF\u4EE5\u6539\u6210\u6211\u4EEC\u8981\u6539\u7684\u7AEF\u53E3\u53F7</p><p>\u8FDE\u63A5MySQL\uFF1A<code>mysql -uroot -pwtq888 -P 3306</code></p></blockquote><h3 id="\u6570\u636E\u5E93\u7BA1\u7406\u754C\u9762" tabindex="-1">\u6570\u636E\u5E93\u7BA1\u7406\u754C\u9762 <a class="header-anchor" href="#\u6570\u636E\u5E93\u7BA1\u7406\u754C\u9762" aria-hidden="true">#</a></h3><p><img src="`+o+'" alt="image-20220525092814117"></p><p>\u5BF9\u4E8E\u6570\u636E\u5E93\u7BA1\u7406\u754C\u9762Navicat\uFF0C\u5176\u754C\u9762\u5982\u4E0B\uFF1A</p><p><img src="'+e+'" alt="image-20220919230529954"></p><h3 id="\u7CFB\u7EDF\u6570\u636E\u5E93" tabindex="-1">\u7CFB\u7EDF\u6570\u636E\u5E93 <a class="header-anchor" href="#\u7CFB\u7EDF\u6570\u636E\u5E93" aria-hidden="true">#</a></h3><blockquote><p>1\u3001<strong>information_schema</strong>\uFF1A\u5B58\u50A8\u6570\u636E\u5E93\u7684\u5143\u6570\u636E\uFF08\u5173\u4E8E\u6570\u636E\u7684\u6570\u636E\uFF0C\u6570\u636E\u5B57\u5178\uFF09\u3002 \u5982\uFF1ATables\u8868\u7528\u4E8E\u5B58\u653E\u670D\u52A1\u5668\u4E2D\u6240\u6709\u6570\u636E\u8868\u7684\u4FE1\u606F\u3002 2\u3001<strong>mysql</strong> \u5B58\u653E\u7528\u6237\u6743\u9650\u3001\u65F6\u533A\uFF1B 3\u3001<strong>performance_schema</strong> \u548Csys \u5B58\u653E\u670D\u52A1\u5668\u7684\u8FD0\u884C\u72B6\u6001\u3002</p></blockquote><h3 id="\u6570\u636E\u5E93\u5904\u7406" tabindex="-1">\u6570\u636E\u5E93\u5904\u7406 <a class="header-anchor" href="#\u6570\u636E\u5E93\u5904\u7406" aria-hidden="true">#</a></h3><p>\u6280\u5DE7\uFF1A\u5728\u6BCF\u6B21\u5E94\u7528\u53D8\u52A8\u65F6\u4F1A\u5728\u7A97\u53E3\u663E\u793ASQL\u8BED\u53E5\uFF0C\u53EF\u4EE5\u5C31\u6B64\u5B66\u4E60SQL\u8BED\u8A00</p><blockquote><p>\u6D4F\u89C8\u5668\u7A97\u53E3\u60AC\u6D6E\u5230\u6570\u636E\u8868\u9879\uFF0C\u53F3\u8FB9\u4E09\u4E2A\u6309\u94AE\u4E2D</p><p>\u7B2C\u4E8C\u4E2A\u662F\u6570\u636E\u8868\u7F16\u8F91\uFF0C\u7B2C\u4E09\u4E2A\u662F\u6570\u636E\u8868\u6570\u636E\u8868\u6570\u636E\u7F16\u8F91\u3002</p></blockquote><h4 id="\u65B0\u5EFA\u6570\u636E\u5E93" tabindex="-1">\u65B0\u5EFA\u6570\u636E\u5E93 <a class="header-anchor" href="#\u65B0\u5EFA\u6570\u636E\u5E93" aria-hidden="true">#</a></h4><p><img src="'+c+'" alt="image-20220525193234452"></p><p>\u4ECENavicat\u65B0\u5EFA\u6570\u636E\u5E93\uFF1A\u5728\u6570\u636E\u5E93\u5B9E\u4F8B\u53F3\u952E&gt;\u65B0\u5EFA\u6570\u636E\u5E93</p><p><img src="'+t+'" alt="image-20220913164504391"></p><p>\u586B\u597D\u6570\u636E\u5E93\u76F8\u5173\u4FE1\u606F\uFF0C\u53EF\u67E5\u770BSQL\u9884\u89C8\u3002</p><p>\u5176\u4E2D\u4E00\u4E2A\u5B57\u7B26\u96C6\u6709\u5BF9\u5E94\u591A\u4E2A\u6821\u9A8C\u89C4\u5219\uFF0C\u9ED8\u8BA4\u4E0D\u586B\u5373\u53EF\u3002</p><p><img src="'+r+'" alt="image-202209131630226" style="zoom:33%;"><img src="'+F+'" alt="image-20220913164746867" style="zoom:50%;"></p><h4 id="\u521B\u5EFA\u6570\u636E\u8868" tabindex="-1">\u521B\u5EFA\u6570\u636E\u8868 <a class="header-anchor" href="#\u521B\u5EFA\u6570\u636E\u8868" aria-hidden="true">#</a></h4><p><img src="'+D+'" alt="image-20220525193352485"></p><blockquote><p>\u4E0B\u8868\u6570\u636E\u7BA1\u7406\u673A\u5236\uFF1A</p><p>\u53CC\u51FB\u9996\u683C\u6DFB\u52A0\u6570\u636E\uFF1B\u8BBE\u7F6E\u7C7B\u578B\uFF1B\u914D\u7F6E\uFF1B\u9ED8\u8BA4\u503C</p><p><strong>\u5E38\u89C1\u7C7B\u578B</strong>\uFF1A</p><ol><li><p>INT\uFF1A\u6574\u6570</p></li><li><p>VARCHAR(n)\uFF1A\u6700\u591An\u4F4D\u5B57\u7B26\u4E32</p></li><li><p>TINYINT(1)\uFF1A\u4F5C\u4E3A<em>\u5E03\u5C14\u503C</em></p><p>MySQL \u5E76\u4E0D\u771F\u6B63\u652F\u6301 BOOL \u7C7B\u578B\uFF0CBOOL \u662F TINYINT(1) \u7684\u522B\u540D\u3002</p></li></ol></blockquote><p><img src="'+y+'" alt="image-20220525193759431"></p><blockquote><p>\u4E5F\u53EF\u4EE5\u76F4\u63A5\u9009\u4E2D\uFF08\u663E\u793A\u4E3A\u84DD\u8272\uFF09\u8981\u8C03\u7684\u6570\u636E\uFF0C\u5728\u4E0B\u9762\u7684\u83DC\u5355\u680F\u8C03</p><p>comments\u4E13\u95E8\u5199\u6570\u636E\u9879\u8BF4\u660E\u3002</p></blockquote><p><img src="'+A+`" alt="image-20220525194345288"></p><h3 id="\u94FE\u63A5\u6570\u636E\u5E93" tabindex="-1">\u94FE\u63A5\u6570\u636E\u5E93 <a class="header-anchor" href="#\u94FE\u63A5\u6570\u636E\u5E93" aria-hidden="true">#</a></h3><h4 id="\u914D\u7F6Emysql" tabindex="-1">\u914D\u7F6EMySql <a class="header-anchor" href="#\u914D\u7F6Emysql" aria-hidden="true">#</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> mysql </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">mysql</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> db </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> mysql</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createPool</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">host</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">127.0.0.1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">//localhost</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">port</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1000</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">user</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">password</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">xxxxxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">database</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">first_database</span><span style="color:#89DDFF;">&#39;</span><span style="color:#676E95;">//\u6570\u636E\u5E93\u540D</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><blockquote><p>\u7136\u540E\u4F7F\u7528<code>db.query()</code>\u6267\u884CSQL\u8BED\u53E5\uFF0C\u5728\u6267\u884CSQL\u8BED\u53E5\u540C\u65F6\u4F1A\u628A\u5360\u4F4D\u7B26<code>?</code>\u66FF\u6362\u4E3A\u540E\u9762\u5BF9\u5E94\u6570\u636E\u3002</p><p>\u4EE5\u4E0B\u56DB\u79CD\u64CD\u4F5C\u90FD\u8981\u7528\u6B64\u51FD\u6570\u3002</p></blockquote><h4 id="\u63D0\u53D6\u6570\u636E" tabindex="-1">\u63D0\u53D6\u6570\u636E <a class="header-anchor" href="#\u63D0\u53D6\u6570\u636E" aria-hidden="true">#</a></h4><blockquote><p>\u5BF9\u5E94GET\u8BF7\u6C42</p><p>\u5173\u952ESQL\u8BED\u53E5\uFF1A<code>SELECT * FROM users;</code></p></blockquote><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">db</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">query</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">SELECT * FROM users;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">try</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#89DDFF;">catch</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">error</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">message</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;">//\u662F\u663E\u793Aerr.message\uFF0C\u4E0D\u662Ferr</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h4 id="\u6DFB\u52A0\u6570\u636E" tabindex="-1">\u6DFB\u52A0\u6570\u636E <a class="header-anchor" href="#\u6DFB\u52A0\u6570\u636E" aria-hidden="true">#</a></h4><blockquote><p>\u5BF9\u5E94POST\u8BF7\u6C42</p><p>\u5173\u952ESQL\u8BED\u53E5\uFF1A<code>INSERT INTO users(data1, data2) VALUES (?, ?);</code></p><p>\u5373<code>INSERT INTO users(x1, x2,...,xn) VALUES (?, ?,...,? );</code></p><p>\u4E00\u6B21\u6027\u52A0\u5165\u5BF9\u5E94\u6570\u636E\uFF08\u8981\u6C42\u5BF9\u8C61\u5B57\u6BB5\u8981\u548C\u6570\u636E\u5E93\u6570\u636E\u8868\u7684\u6BCF\u4E2A\u6570\u636E\u9879\u4E00\u4E00\u5BF9\u5E94\uFF09\uFF1A</p><p><code>INSERT INTO users SET ?</code></p><p>\u6DFB\u52A0\u64CD\u4F5C\u65F6\uFF0Cquery\u53C2\u6570\u5982\u4E0B\uFF1A</p><p><code>db.query(sql_code,data,callback)</code></p><p>\u5728\u7528\u4E00\u6B21\u6027\u52A0\u5165\u5BF9\u5E94\u6570\u636E\u64CD\u4F5C\u65F6data\u6570\u636E\u7C7B\u578B\u8981\u662F\u6570\u7EC4\uFF0C\u4E14\u4F1A\u6309\u7167\u6A21\u677F\u4ECE\u5DE6\u5230\u53F3\u4F9D\u6B21\u6309\u987A\u5E8F\u6DFB\u52A0\u3002</p><p>\u6BD4\u5982<code>update \${DATA_TABLE} set Sname = ?, Ssex = ?, Sage = ?, Sdep = ? where Sno = ?</code>\u8981\u4EE5\u4E0B\u9762\u7684\u6570\u7EC4\u987A\u5E8F\u4F20\u53C2\uFF1A<code>[Sname, Ssex, Sage, Sdep, Sno]</code></p></blockquote><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> user01 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">LiWeikang</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">password</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">kang114514</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">db</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">query</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">INSERT INTO users(username, password) VALUES (?, ?);</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> [user01</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">user</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">password]</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">try</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">affectedRows</span><span style="color:#89DDFF;">===</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">\u63D2\u5165\u6210\u529F\uFF01</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">else</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">\u63D2\u5165\u5931\u8D25|||</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#89DDFF;">catch</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">error</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">message</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;">//\u662F\u663E\u793Aerr.message\uFF0C\u4E0D\u662Ferr</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><table><thead><tr><th>\u64CD\u4F5C\u524D</th><th>\u64CD\u4F5C\u540E</th></tr></thead><tbody><tr><td><img src="`+C+'" alt="image-20220525200025102"></td><td><img src="'+s+`" alt="image-20220525211813419"></td></tr></tbody></table><h4 id="\u66F4\u65B0\u6570\u636E" tabindex="-1">\u66F4\u65B0\u6570\u636E <a class="header-anchor" href="#\u66F4\u65B0\u6570\u636E" aria-hidden="true">#</a></h4><blockquote><p>\u5BF9\u5E94PUT\u3001PATCH\u8BF7\u6C42</p><p>\u5173\u952ESQL\u8BED\u53E5\uFF1A<code>UPDATE users SET data1= ?, data2= ? WHERE (id = ?);</code></p></blockquote><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> user01 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">id</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">LiWeikang</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">password</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">kang114514</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">db</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">query</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">UPDATE users SET data1=?, data2=? WHERE (id = ?);</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> [user01</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">user01</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">password</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">user01</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id]</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">try</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">affectedRows</span><span style="color:#89DDFF;">===</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">\u66F4\u65B0\u6210\u529F\uFF01</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">else</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">\u66F4\u65B0\u5931\u8D25|||</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#89DDFF;">catch</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">error</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">message</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><table><thead><tr><th>\u64CD\u4F5C\u524D</th><th>\u64CD\u4F5C\u540E</th></tr></thead><tbody><tr><td><img src="`+s+'" alt="image-20220525211813419"></td><td><img src="'+i+`" alt="image-20220525211856834"></td></tr></tbody></table><h4 id="\u5220\u9664\u6570\u636E" tabindex="-1">\u5220\u9664\u6570\u636E <a class="header-anchor" href="#\u5220\u9664\u6570\u636E" aria-hidden="true">#</a></h4><blockquote><p>\u5BF9\u5E94DELETE\u8BF7\u6C42</p><p>\u5173\u952ESQL\u8BED\u53E5\uFF1A<code>DELETE FROM users WHERE ( id = ? );</code></p></blockquote><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">db</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">query</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">DELETE FROM users WHERE ( id = ? );</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">try</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">affectedRows</span><span style="color:#89DDFF;">===</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">\u5220\u9664\u6210\u529F\uFF01</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">else</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">\u5220\u9664\u5931\u8D25|||</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#89DDFF;">catch</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">error</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">message</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><blockquote><p>\u4E5F\u53EF\u4EE5\u901A\u8FC7UPDATE\u6765\u6807\u8BC6\u5220\u9664\uFF0C\u4ECE\u800C\u4FDD\u7559\u6570\u636E\u5E93\u7684\u6570\u636E\u3002\u8FD9\u5728\u9632\u8BEF\u5220\u7684\u60C5\u51B5\u4E0B\u662F\u5341\u5206\u6709\u7528\u7684\u3002</p></blockquote><p><img src="`+d+`" alt="image-20220525213631711"></p><h3 id="\u5C01\u88C5mysql\u5E93" tabindex="-1">\u5C01\u88C5MySql\u5E93 <a class="header-anchor" href="#\u5C01\u88C5mysql\u5E93" aria-hidden="true">#</a></h3><p>\u6216\u8005\u76F4\u63A5\u7528mysql2</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> mysql </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">mysql</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> db </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> mysql</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createPool</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{...}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">//\u5C01\u88C5db.query\u4EE5\u652F\u6301promise</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">betterQuery</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">sql</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">values</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#F07178;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">reject</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">db</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getConnection</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">error</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">connect</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;">=&gt;</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">reject</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#89DDFF;">else</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">connect</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">query</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">sql</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">values</span><span style="color:#89DDFF;">,(</span><span style="color:#A6ACCD;">error</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;">=&gt;</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">reject</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">}</span><span style="color:#89DDFF;">else</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">connect</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">release</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports={</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">query</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">betterQuery</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="\u4E09\u5C42\u4F53\u7CFB\u67B6\u6784" tabindex="-1">\u4E09\u5C42\u4F53\u7CFB\u67B6\u6784 <a class="header-anchor" href="#\u4E09\u5C42\u4F53\u7CFB\u67B6\u6784" aria-hidden="true">#</a></h2><blockquote><p>\u4E09\u5C42\u67B6\u6784\u662F\u4E00\u79CD\u5C06\u5E94\u7528\u7A0B\u5E8F\u5206\u89E3\u4E3A\u8868\u793A\u5C42(Presentation Layer)\u3001\u4E1A\u52A1\u903B\u8F91\u5C42(Business Logic Layer)\u548C\u6570\u636E\u8BBF\u95EE\u5C42(Data Access Layer)\u7684\u4F20\u7EDF\u8F6F\u4EF6\u67B6\u6784\u6A21\u5F0F\u3002\u8FD9\u79CD\u5206\u5C42\u65B9\u5F0F\u4F7F\u5F97\u6BCF\u4E00\u5C42\u76F8\u5BF9\u72EC\u7ACB,\u6709\u5229\u4E8E\u4EE3\u7801\u7684\u53EF\u7EF4\u62A4\u6027\u548C\u53EF\u6269\u5C55\u6027\u3002</p><ol><li>\u8868\u793A\u5C42(Presentation Layer)\uFF1A\u8868\u793A\u5C42\u8D1F\u8D23\u5904\u7406 HTTP \u8BF7\u6C42\u3001\u54CD\u5E94,\u4EE5\u53CA\u89C6\u56FE\u6E32\u67D3\u7B49\u4E0E\u8868\u73B0\u5F62\u5F0F\u76F8\u5173\u7684\u5185\u5BB9\u3002</li><li>\u4E1A\u52A1\u903B\u8F91\u5C42(Business Logic Layer)\uFF1A\u4E1A\u52A1\u903B\u8F91\u5C42\u662F\u6574\u4E2A\u5E94\u7528\u7684\u6838\u5FC3,\u8D1F\u8D23\u5904\u7406\u7CFB\u7EDF\u7684\u4E3B\u8981\u529F\u80FD\u548C\u4E1A\u52A1\u89C4\u5219\u3002</li><li>\u6570\u636E\u8BBF\u95EE\u5C42(Data Access Layer)\uFF1A\u6570\u636E\u8BBF\u95EE\u5C42\u8D1F\u8D23\u4E0E\u6570\u636E\u6E90(\u5982\u6570\u636E\u5E93\u3001\u6587\u4EF6\u7CFB\u7EDF\u7B49)\u8FDB\u884C\u4EA4\u4E92,\u6267\u884C\u6570\u636E\u7684\u589E\u5220\u6539\u67E5\u64CD\u4F5C\u3002</li></ol></blockquote><p><code>router.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> router </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">koa-router</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)()</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> userCtrl </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../controller/c-user</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">prefix</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">/******** \u4E09\u5C42\u67B6\u6784\u4F53\u7CFB\u4E4B\u8868\u793A\u5C42 ********/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// \u8DEF\u7531\u7EDF\u4E00\u540E\u7EED\u4E2D\u95F4\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">() </span><span style="color:#676E95;">// ctx.body\u8D4B\u503C\u4E86\u4E4B\u540E\u5728\u7EE7\u7EED\u4E3Astatus\u8D4B\u503C</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">flag</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">delete</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">userCtrl</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">userLogin</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">request</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p><code>controller.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> userConn </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../models/m-users</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;">/***** \u52A0\u5BC6\u7B97\u6CD5\u4F7F\u7528 *****/</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> bcrypt </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">bcryptjs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;">/***** JWT\u4F7F\u7528 *****/</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> jwt </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">jsonwebtoken</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;">/***** \u73AF\u5883\u53D8\u91CF\u4F7F\u7528 *****/</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> dotenv </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dotenv</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">dotenv</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">config</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">/******** \u7528\u6237\u767B\u5F55 ********/</span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">userLogin</span><span style="color:#89DDFF;">({</span><span style="color:#A6ACCD;">username</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">password</span><span style="color:#89DDFF;">})</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">queryRes</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">userConn</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isUserExist</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">username</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">queryRes</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">status</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">400</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> msg</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">\u8BE5\u7528\u6237\u4E0D\u5B58\u5728\u2026\u2026</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// \u8D26\u53F7\u662F\u5426\u5B58\u5728\uFF0C\u5B58\u5728\u5219\u7EE7\u7EED</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">querySelected</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">queryRes</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">bcrypt</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">compareSync</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">password</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">querySelected</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">password</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">status</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">400</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> msg</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">\u5BC6\u7801\u9519\u8BEF\uFF0C\u8BF7\u91CD\u8BD5\u3002</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">delete</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">querySelected</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">password</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// \u5220\u9664\u5BC6\u7801\u5C5E\u6027</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tokenStr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">jwt</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sign</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">querySelected</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">env</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">JWT_SECRET_KEY</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">expiresIn</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">1 d</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">status</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> msg</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">\u767B\u5F55\u6210\u529F\uFF01</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> token</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">Bearer </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">tokenStr</span><span style="color:#89DDFF;">}\`</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">userSignup</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> userLogin</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><code>model.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> mysql </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../db/mysqlDB</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">isUserExist</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">username</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mysql</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">query</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">select * from \`user_basic\` where username=?;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">username</span><span style="color:#F07178;">])</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">rows</span><span style="color:#89DDFF;">])</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">rows</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">insertUser</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">username</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">password</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">joined_in</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Date</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mysql</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">query</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">insert into \`user_basic\` set ?</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">username</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">password</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">joined_in</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">rows</span><span style="color:#89DDFF;">])</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">rows</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">affectedRows</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  isUserExist</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  insertUser</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div>`,105),h=[g];function E(b,q,m,x,k,f){return l(),a("div",null,h)}const v=n(u,[["render",E]]);export{j as __pageData,v as default};

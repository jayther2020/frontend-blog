<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SQL高级知识 | ✨杰者-前端知识库✨</title>
    <meta name="description" content="用来整理自己所学的前端知识，收藏过的技术博客，心得体会等">
    <link rel="stylesheet" href="/frontend-blog/assets/style.efc7c571.css">
    <link rel="modulepreload" href="/frontend-blog/assets/app.d773c0a6.js">
    <link rel="modulepreload" href="/frontend-blog/assets/pages_computer-knowledge-stack_sql_advanced_index.md.7c5346ea.lean.js">
    
    <link rel="icon" href="/frontend-blog/common/icon.ico">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-c6a644e1><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav" data-v-c6a644e1 data-v-a71a30f1><div class="VPNavBar has-sidebar" data-v-a71a30f1 data-v-6f1d18b5><div class="container" data-v-6f1d18b5><div class="VPNavBarTitle has-sidebar" data-v-6f1d18b5 data-v-d5925166><a class="title" href="/frontend-blog/" data-v-d5925166><!--[--><!--]--><!----><!--[-->博客首页<!--]--><!--[--><!--]--></a></div><div class="content" data-v-6f1d18b5><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6f1d18b5 data-v-f83db6ba><span id="main-nav-aria-label" class="visually-hidden" data-v-f83db6ba>Main Navigation</span><!--[--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f83db6ba data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6ffb57d3><span class="text" data-v-6ffb57d3><!----> 前端基础 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6ffb57d3><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><div class="items" data-v-1c5d0cfc><!--[--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="/frontend-blog/pages/front-end-stack/html-common/" data-v-e8e0fb1d data-v-3c355974><!--[-->HTML<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="/frontend-blog/pages/front-end-stack/css-basic/" data-v-e8e0fb1d data-v-3c355974><!--[-->CSS<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="/frontend-blog/pages/front-end-stack/js-basic/" data-v-e8e0fb1d data-v-3c355974><!--[-->Javascript<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f83db6ba data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6ffb57d3><span class="text" data-v-6ffb57d3><!----> 前端框架 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6ffb57d3><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><div class="items" data-v-1c5d0cfc><!--[--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="/frontend-blog/pages/front-end-application/vue/v2-features/" data-v-e8e0fb1d data-v-3c355974><!--[-->Vue<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="/frontend-blog/pages/front-end-application/react/basic/" data-v-e8e0fb1d data-v-3c355974><!--[-->React<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="/frontend-blog/pages/front-end-application/nodejs/basic/" data-v-e8e0fb1d data-v-3c355974><!--[-->Nodejs<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="/frontend-blog/pages/front-end-application/visual/d3/" data-v-e8e0fb1d data-v-3c355974><!--[-->前端可视化<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/frontend-blog/pages/computer-knowledge-stack/" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->计算机基础<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/frontend-blog/pages/useful/" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->前端工具<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/frontend-blog/pages/thoughts/" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->心得体会<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6f1d18b5 data-v-a3e7452b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-a3e7452b data-v-31fdf26f data-v-eba7420e><span class="check" data-v-eba7420e><span class="icon" data-v-eba7420e><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-31fdf26f><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-31fdf26f><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6f1d18b5 data-v-738bef5a data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://gitee.com/jayther2020" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>码云</title><path d="M11.984 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.016 0zm6.09 5.333c.328 0 .593.266.592.593v1.482a.594.594 0 0 1-.593.592H9.777c-.982 0-1.778.796-1.778 1.778v5.63c0 .327.266.592.593.592h5.63c.982 0 1.778-.796 1.778-1.778v-.296a.593.593 0 0 0-.592-.593h-4.15a.592.592 0 0 1-.592-.592v-1.482a.593.593 0 0 1 .593-.592h6.815c.327 0 .593.265.593.592v3.408a4 4 0 0 1-4 4H5.926a.593.593 0 0 1-.593-.593V9.778a4.444 4.444 0 0 1 4.445-4.444h8.296Z"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6f1d18b5 data-v-e4361c82 data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-6ffb57d3><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-6ffb57d3><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><!----><!--[--><!--[--><!----><div class="group" data-v-e4361c82><div class="item appearance" data-v-e4361c82><p class="label" data-v-e4361c82>Appearance</p><div class="appearance-action" data-v-e4361c82><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-e4361c82 data-v-31fdf26f data-v-eba7420e><span class="check" data-v-eba7420e><span class="icon" data-v-eba7420e><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-31fdf26f><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-31fdf26f><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-e4361c82><div class="item social-links" data-v-e4361c82><div class="VPSocialLinks social-links-list" data-v-e4361c82 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://gitee.com/jayther2020" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>码云</title><path d="M11.984 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.016 0zm6.09 5.333c.328 0 .593.266.592.593v1.482a.594.594 0 0 1-.593.592H9.777c-.982 0-1.778.796-1.778 1.778v5.63c0 .327.266.592.593.592h5.63c.982 0 1.778-.796 1.778-1.778v-.296a.593.593 0 0 0-.592-.593h-4.15a.592.592 0 0 1-.592-.592v-1.482a.593.593 0 0 1 .593-.592h6.815c.327 0 .593.265.593.592v3.408a4 4 0 0 1-4 4H5.926a.593.593 0 0 1-.593-.593V9.778a4.444 4.444 0 0 1 4.445-4.444h8.296Z"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6f1d18b5 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-c6a644e1 data-v-aac27d5e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-aac27d5e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-aac27d5e><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-aac27d5e>Menu</span></button><a class="top-link" href="#" data-v-aac27d5e> Return to top </a></div><aside class="VPSidebar" data-v-c6a644e1 data-v-0f582cdc><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-0f582cdc><span class="visually-hidden" id="sidebar-aria-label" data-v-0f582cdc> Sidebar Navigation </span><!--[--><div class="group" data-v-0f582cdc><section class="VPSidebarGroup collapsible" data-v-0f582cdc data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>算法和数据结构</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/frontend-blog/pages/computer-knowledge-stack/algorithm/complexity/" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>算法理论</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/frontend-blog/pages/computer-knowledge-stack/algorithm/main/" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>主要算法</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/frontend-blog/pages/computer-knowledge-stack/algorithm/others/" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>其他算法</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-0f582cdc><section class="VPSidebarGroup collapsible" data-v-0f582cdc data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>数据库相关</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/frontend-blog/pages/computer-knowledge-stack/sql/basic/" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>SQL</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-0f582cdc><section class="VPSidebarGroup collapsible" data-v-0f582cdc data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>计算机网络</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/frontend-blog/pages/computer-knowledge-stack/browser/" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>浏览器相关</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-c6a644e1 data-v-c95df128><div class="VPDoc has-sidebar has-aside" data-v-c95df128 data-v-37ebe389><div class="container" data-v-37ebe389><div class="aside" data-v-37ebe389><div class="aside-curtain" data-v-37ebe389></div><div class="aside-container" data-v-37ebe389><div class="aside-content" data-v-37ebe389><div class="VPDocAside" data-v-37ebe389 data-v-afc4c1a1><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-afc4c1a1 data-v-2865c0b0><div class="content" data-v-2865c0b0><div class="outline-marker" data-v-2865c0b0></div><div class="outline-title" data-v-2865c0b0>目录</div><nav aria-labelledby="doc-outline-aria-label" data-v-2865c0b0><span class="visually-hidden" id="doc-outline-aria-label" data-v-2865c0b0> Table of Contents for current page </span><ul class="root" data-v-2865c0b0 data-v-1188541a><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-afc4c1a1></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-37ebe389><div class="content-container" data-v-37ebe389><!--[--><!--]--><main class="main" data-v-37ebe389><div style="position:relative;" class="vp-doc _frontend-blog_pages_computer-knowledge-stack_sql_advanced_index" data-v-37ebe389><div><h1 id="sql高级知识" tabindex="-1">SQL高级知识 <a class="header-anchor" href="#sql高级知识" aria-hidden="true">#</a></h1><h2 id="sql编程" tabindex="-1">SQL编程 <a class="header-anchor" href="#sql编程" aria-hidden="true">#</a></h2><h3 id="常量与变量" tabindex="-1">常量与变量 <a class="header-anchor" href="#常量与变量" aria-hidden="true">#</a></h3><ol><li><p>常量</p><p>字符串类型的常量、日期时间类型的常量要用单引号括起来。</p></li></ol><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Chinese Dream</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2022-10-01</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre></div><p>NULL值</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">NULL</span></span>
<span class="line"></span></code></pre></div><ol start="2"><li>变量</li></ol><p>MySQL中的变量分为两种：系统变量、自定义变量</p><p>==系统变量==由系统定义，分为：<em>全局变量</em>和<em>会话变量</em>。 ==自定义变量==由用户自己定义的，分为：<em>用户变量</em>和<em>局部变量</em>。</p><ul><li><p>全局变量</p><blockquote><p>全局变量的值影响整个MySQL服务器。 全局变量的值在MySQL启动时由服务器自动初始化为默认值。</p></blockquote><p><strong>作用域</strong>：MySQL服务器的整个生命周期。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#676E95;">-- 查看全局变量</span></span>
<span class="line"><span style="color:#A6ACCD;">show </span><span style="color:#F78C6C;">global</span><span style="color:#A6ACCD;"> variables;</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> @@</span><span style="color:#F78C6C;">global</span><span style="color:#A6ACCD;">.auto_increment_increment;</span></span>
<span class="line"><span style="color:#A6ACCD;">show </span><span style="color:#F78C6C;">global</span><span style="color:#A6ACCD;"> variables </span><span style="color:#F78C6C;">like</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">auto%</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">修改全局变量</span></span>
<span class="line"><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">global</span><span style="color:#A6ACCD;"> auto_increment_increment </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> @@</span><span style="color:#F78C6C;">global</span><span style="color:#A6ACCD;">.auto_increment_increment </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><p>修改配置文件my.ini,重启服务。</p><p>赋值的操作符：<code>=</code>或<code>:=</code>。 作用域：针对于当前会话（连接）有效，同于会话变量的作用域，应用在任何地方，也就是<code>begin...end</code>里面或<code>begin...end</code>外边。</p><ul><li>声明变量并初始化</li></ul><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">SET</span><span style="color:#A6ACCD;"> @用户变量名 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> 值;</span><span style="color:#F78C6C;">SET</span><span style="color:#A6ACCD;"> @用户变量名 :</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> 值;</span></span>
<span class="line"></span></code></pre></div></li><li><p>会话变量</p><blockquote><p>在每次建立一个连接时，MySQL服务器将当前所有的全局变量的值复制一份给会话变量。</p></blockquote><p><strong>作用域</strong>：仅限于当前会话。每个客户端连接中的会话变量是相互独立的。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#676E95;">-- 查看会话变量</span></span>
<span class="line"><span style="color:#A6ACCD;">show </span><span style="color:#F78C6C;">session</span><span style="color:#A6ACCD;"> variables;</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> @@</span><span style="color:#F78C6C;">session</span><span style="color:#A6ACCD;">.auto_increment_increment;</span></span>
<span class="line"><span style="color:#A6ACCD;">show </span><span style="color:#F78C6C;">session</span><span style="color:#A6ACCD;"> variables </span><span style="color:#F78C6C;">like</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">auto%</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#676E95;">-- 修改会话变量</span></span>
<span class="line"><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">session</span><span style="color:#A6ACCD;"> auto_increment_increment </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> @@</span><span style="color:#F78C6C;">session</span><span style="color:#A6ACCD;">.auto_increment_increment </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div></li><li><p>局部变量</p><blockquote><p>一般==用于begin...end语句块==中，作用域仅限于该语句块。 beign...end代码块,以及局部变量只能==用在函数、存储过程、游标、触发器中==。</p></blockquote><p>使用declare关键字进行声明。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#676E95;">-- 声明局部变量</span></span>
<span class="line"><span style="color:#F78C6C;">declare</span><span style="color:#A6ACCD;"> 变量名数据类型（长度）；</span></span>
<span class="line"><span style="color:#F78C6C;">declare</span><span style="color:#A6ACCD;"> 变量名数据类型（长度）default初始值；</span></span>
<span class="line"><span style="color:#676E95;">-- 为局部变量赋值</span></span>
<span class="line"><span style="color:#A6ACCD;">set局部变量1</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">值1，局部变量2</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">值2，…</span></span>
<span class="line"><span style="color:#A6ACCD;">select字段l,字段2，</span><span style="color:#F78C6C;">into</span><span style="color:#A6ACCD;"> 局部变量l,局部变量2，.</span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;">..</span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;">.…</span></span>
<span class="line"></span></code></pre></div></li><li><p>用户变量</p></li></ul><h3 id="流程控制语句" tabindex="-1">流程控制语句 <a class="header-anchor" href="#流程控制语句" aria-hidden="true">#</a></h3><p>流程控制语句要放在存储过程、存储函数、游标、触发器的内部。</p><ol><li><p><code>if</code></p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">if</span><span style="color:#A6ACCD;">...</span><span style="color:#F78C6C;">then</span><span style="color:#A6ACCD;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">elseif ...</span><span style="color:#F78C6C;">then</span><span style="color:#A6ACCD;">...</span></span>
<span class="line"><span style="color:#F78C6C;">else</span><span style="color:#A6ACCD;">...</span></span>
<span class="line"><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">if</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div></li><li><p><code>while</code></p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">while</span><span style="color:#A6ACCD;">...#继续循环条件</span></span>
<span class="line"><span style="color:#A6ACCD;">do</span></span>
<span class="line"><span style="color:#A6ACCD;"># 循环体</span></span>
<span class="line"><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">while</span></span>
<span class="line"></span></code></pre></div></li><li><p><code>repeat</code></p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">repeat</span></span>
<span class="line"><span style="color:#A6ACCD;">#循环体</span></span>
<span class="line"><span style="color:#A6ACCD;">until ...#终止循环条件</span></span>
<span class="line"><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">repeat</span></span>
<span class="line"></span></code></pre></div></li><li><p><code>loop</code></p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">loop</span></span>
<span class="line"><span style="color:#A6ACCD;">#循环体</span></span>
<span class="line"><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">loop</span></span>
<span class="line"></span></code></pre></div></li><li><p><code>leave</code></p><blockquote><p>用于跳出循环，类似于C语言中的<code>break</code>;</p></blockquote></li><li><p><code>iterate</code></p><blockquote><p>用于退出本次循环，类以于C语言中的<code>continue</code></p></blockquote></li></ol><p>eg:<code>1+2+..+100</code></p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">procedure</span><span style="color:#A6ACCD;"> usp_Sum(n </span><span style="color:#F78C6C;">int</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#F78C6C;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">declare</span><span style="color:#A6ACCD;"> i,</span><span style="color:#82AAFF;">sum</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">int</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> i</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">,</span><span style="color:#82AAFF;">sum</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">while</span><span style="color:#A6ACCD;"> i</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">n do</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> i</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">sum</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">sum</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;">i;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F78C6C;">while</span><span style="color:#A6ACCD;"> i</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">n do</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> i</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">sum</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">sum</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;">i;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">while</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">concat</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">1+2+..+100=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#82AAFF;">sum</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">while</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">concat</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">1+2+..+100=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#82AAFF;">sum</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">调用</span></span>
<span class="line"><span style="color:#F78C6C;">call</span><span style="color:#A6ACCD;"> usp_Sum(</span><span style="color:#F78C6C;">100</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"></span></code></pre></div><p>7、<code>case</code>两种用法： (1)</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">case</span><span style="color:#A6ACCD;"> case_value</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">when</span><span style="color:#A6ACCD;"> 值1 </span><span style="color:#F78C6C;">then</span><span style="color:#A6ACCD;"> 语句1</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">when</span><span style="color:#A6ACCD;"> 值2 </span><span style="color:#F78C6C;">then</span><span style="color:#A6ACCD;"> 语句2</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">else</span><span style="color:#A6ACCD;">...</span></span>
<span class="line"><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">case</span></span>
<span class="line"></span></code></pre></div><p>(2)</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">case</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">when</span><span style="color:#A6ACCD;"> 条件1 </span><span style="color:#F78C6C;">then</span><span style="color:#A6ACCD;"> 语句l;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">when</span><span style="color:#A6ACCD;"> 条件2 </span><span style="color:#F78C6C;">then</span><span style="color:#A6ACCD;"> 语句2；</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">when</span><span style="color:#A6ACCD;"> 条件n </span><span style="color:#F78C6C;">then</span><span style="color:#A6ACCD;"> 语句n;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">else</span><span style="color:#A6ACCD;">....</span></span>
<span class="line"><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">case</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">when</span><span style="color:#A6ACCD;"> 条件n </span><span style="color:#F78C6C;">then</span><span style="color:#A6ACCD;"> 语句n;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">else</span><span style="color:#A6ACCD;">...</span></span>
<span class="line"><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">case</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><p>思考+20 -输入学生的学号和课程号，输出该生该门课的等级(ABCED)</p><h3 id="函数" tabindex="-1">函数 <a class="header-anchor" href="#函数" aria-hidden="true">#</a></h3><blockquote><p>下面我们要接触是用户自定义函数。</p></blockquote><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#A6ACCD;">delimiter </span><span style="color:#89DDFF;">//</span><span style="color:#A6ACCD;">　　#如果函数体只有一条语句, begin和end可以省略, 同时delimiter也可以省略</span></span>
<span class="line"><span style="color:#A6ACCD;">　　</span><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">函数名</span><span style="color:#A6ACCD;">(形参列表) </span><span style="color:#F78C6C;">returns</span><span style="color:#A6ACCD;"> 返回类型　　#注意是retruns</span></span>
<span class="line"><span style="color:#A6ACCD;">　　</span><span style="color:#F78C6C;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">　　　　函数体　　　　#函数内定义的变量如：</span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> @x </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">; 变量x为全局变量，在函数外面也可以使用</span></span>
<span class="line"><span style="color:#A6ACCD;">　　　　返回值</span></span>
<span class="line"><span style="color:#A6ACCD;">　　</span><span style="color:#F78C6C;">end</span></span>
<span class="line"><span style="color:#A6ACCD;">　　</span><span style="color:#89DDFF;">//</span></span>
<span class="line"><span style="color:#A6ACCD;">delimiter ;</span></span>
<span class="line"></span></code></pre></div><p>关于函数体:</p><ol><li>函数体由合法的<code>SQL</code>语句构成；</li><li>函数体可以是简单的<code>SELECT</code>或<code>INSERT</code>语句；</li><li>函数体如果为复合结构则使用<code>begin...end</code>语句；</li><li>复合结构可以包含声明，循环，控制结构。</li></ol><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#676E95;">-- 输入：学号</span></span>
<span class="line"><span style="color:#676E95;">-- 返回值：平均分</span></span>
<span class="line"><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">global</span><span style="color:#A6ACCD;"> log_bin_trust_function_creators </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">true;</span></span>
<span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">function</span><span style="color:#A6ACCD;"> fn_GetAvgGrade(vSno </span><span style="color:#F78C6C;">int</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">returns</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">-- 函数的返回值的数据类型是int</span></span>
<span class="line"><span style="color:#F78C6C;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">declare</span><span style="color:#A6ACCD;"> vGrade </span><span style="color:#F78C6C;">int</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">avg</span><span style="color:#A6ACCD;">(Grade)</span><span style="color:#F78C6C;">into</span><span style="color:#A6ACCD;"> vGrade </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> SC </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> Sno vSno;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">return</span><span style="color:#A6ACCD;"> vGrade;</span></span>
<span class="line"><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#676E95;">-- 调用</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> fn_GetAvgGrade(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2022001</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"></span></code></pre></div><h2 id="视图" tabindex="-1">视图 <a class="header-anchor" href="#视图" aria-hidden="true">#</a></h2><blockquote><p>1、什么是视图？</p><p>视图View是从一个或多个基本表或视图中导出的一个==虚表==。 视图中==不存放数据==的；数据是存放在基本表中的。 和基本表一样，对视图也可以执行增删改查操作。*对视图的操作，都会转换为对基本表的操作。*这叫<strong>视图消解</strong>。</p><p>2、为什么要使用视图？</p><p>(1)可以简化查询操作 (2)可以提高数据的安全性</p></blockquote><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> view 视图名</span></span>
<span class="line"><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> ...;</span></span>
<span class="line"></span></code></pre></div><h3 id="创建视图" tabindex="-1">创建视图 <a class="header-anchor" href="#创建视图" aria-hidden="true">#</a></h3><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#A6ACCD;">#创建多表视图</span></span>
<span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> view v1</span></span>
<span class="line"><span style="color:#F78C6C;">as</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> student.Sno,student.Sname,course.Cname,sc.Grade</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> student </span><span style="color:#F78C6C;">INNER JOIN</span><span style="color:#A6ACCD;"> sc</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> student.Sno sc.Sno </span><span style="color:#F78C6C;">INNER JOIN</span><span style="color:#A6ACCD;"> course </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> sc.Cno course.Cno;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> student.Sno,student.Sname,course.Cname,sc.Grade</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> student </span><span style="color:#F78C6C;">INNER JOIN</span><span style="color:#A6ACCD;"> sc</span></span>
<span class="line"><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> student.Sno sc.Sno </span><span style="color:#F78C6C;">INNER JOIN</span><span style="color:#A6ACCD;"> course </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> sc.Cno course.Cno;</span></span>
<span class="line"><span style="color:#F78C6C;">and</span><span style="color:#A6ACCD;"> Cname</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">数据库</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> student.Sno,student.Sname,course.Cname,sc.Grade</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> student </span><span style="color:#F78C6C;">INNER JOIN</span><span style="color:#A6ACCD;"> sc</span></span>
<span class="line"><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> student.Sno sc.Sno </span><span style="color:#F78C6C;">INNER JOIN</span><span style="color:#A6ACCD;"> course </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> sc.Cno course.Cno</span></span>
<span class="line"><span style="color:#F78C6C;">and</span><span style="color:#A6ACCD;"> Grade </span><span style="color:#F78C6C;">60</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><h3 id="视图操作" tabindex="-1">视图操作 <a class="header-anchor" href="#视图操作" aria-hidden="true">#</a></h3><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#676E95;">-- 查询视图</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> v1;</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#89DDFF;">*</span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> vl </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> Cname</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">数据库</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">；</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> v1 </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> Grade </span><span style="color:#F78C6C;">60</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">-- 通过视图像基本表中插入数据</span></span>
<span class="line"><span style="color:#F78C6C;">insert</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">into</span><span style="color:#A6ACCD;"> v2 </span><span style="color:#F78C6C;">values</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2021005</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">小吴</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">男</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">18</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">CS</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#89DDFF;">*</span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> Student;</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#89DDFF;">*</span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> v2;</span></span>
<span class="line"><span style="color:#F78C6C;">insert</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">into</span><span style="color:#A6ACCD;"> v2 </span><span style="color:#F78C6C;">values</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2021006</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">小六</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">男</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">18</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">MA</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">-- 修改视图</span></span>
<span class="line"><span style="color:#F78C6C;">alter</span><span style="color:#A6ACCD;"> view v2</span></span>
<span class="line"><span style="color:#F78C6C;">as</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">select</span><span style="color:#89DDFF;">*</span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> Student </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> Sdept</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cs</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">with</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">check</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">option</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#89DDFF;"> </span><span style="color:#676E95;">--  查询视图和基本表</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">select</span><span style="color:#89DDFF;">*</span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> v2;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">select</span><span style="color:#89DDFF;">*</span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> Student;</span></span>
<span class="line"><span style="color:#89DDFF;"> </span><span style="color:#676E95;">-- 通过视图向基本表中插入数据</span></span>
<span class="line"><span style="color:#F78C6C;">insert</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">into</span><span style="color:#A6ACCD;"> v2 </span><span style="color:#F78C6C;">values</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2021007</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">小七</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">男</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">18</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">CS</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#F78C6C;">insert</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">into</span><span style="color:#A6ACCD;"> v2 </span><span style="color:#F78C6C;">values</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2021008</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">小八</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">男</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">18</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">MA</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">);</span><span style="color:#676E95;">-- 	会提示错误</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">-- 	通过视图修改基本表</span></span>
<span class="line"><span style="color:#F78C6C;">update</span><span style="color:#A6ACCD;"> Student </span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> Sage</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">18</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#F78C6C;">update</span><span style="color:#A6ACCD;"> v2 </span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> Sage</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">Sage</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;">;</span><span style="color:#676E95;">-- 该语句会转化为：</span></span>
<span class="line"><span style="color:#F78C6C;">update</span><span style="color:#A6ACCD;"> Student </span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> Sage</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">Sage</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> Sdept</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">-- 修改视图:并不是所有视图都可以更新</span></span>
<span class="line"><span style="color:#676E95;">-- 创建一个视图：修改每个学生的学号和平均成绩</span></span>
<span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> view v3</span></span>
<span class="line"><span style="color:#F78C6C;">as</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> Sno,</span><span style="color:#82AAFF;">avg</span><span style="color:#A6ACCD;">(Grade) avgGrade </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> sc </span></span>
<span class="line"><span style="color:#F78C6C;">group by</span><span style="color:#A6ACCD;"> Sno;</span></span>
<span class="line"><span style="color:#676E95;">-- 查询视图</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> v3;</span></span>
<span class="line"><span style="color:#676E95;">-- 修改视图</span></span>
<span class="line"><span style="color:#F78C6C;">update</span><span style="color:#A6ACCD;"> v3 </span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> avgGrade</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">80</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> Sno</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2022001</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> SC;</span></span>
<span class="line"></span></code></pre></div><blockquote><p>问：什么样的视图是可以更新的？什么样的视图是不可以更新的？</p><p>答: 一般的行列子集视图是可以更新的。视图不能更新有以下情况:</p><ol><li>视图的字段来自<em>字段表达式</em>或常数</li><li>视图的字段来自<em>聚集函数</em></li><li>视图的定义中含有<em>Group By子句</em></li><li>视图的定义中含有<em>DISTINCT</em>关键字</li><li>视图定义中有<em>嵌套查询</em></li></ol></blockquote><h2 id="索引" tabindex="-1">索引 <a class="header-anchor" href="#索引" aria-hidden="true">#</a></h2><blockquote><p><strong>什么是索引？</strong> 类似于书的目录。索引的创建和维护需要时间的。</p><p><strong>为什么使用索引？</strong> 提高数据的查询速度。可索引并非越多越好。</p></blockquote><p>索引的类型：</p><ol><li>普通索引和唯一索引</li><li>单列索引和组合索引</li></ol><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">index</span><span style="color:#A6ACCD;"> 索引名 </span><span style="color:#F78C6C;">on</span><span style="color:#A6ACCD;"> 表名 (字段名 </span><span style="color:#F78C6C;">asc</span><span style="color:#A6ACCD;">|</span><span style="color:#F78C6C;">desc</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">show </span><span style="color:#F78C6C;">index</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> 表名;</span></span>
<span class="line"><span style="color:#A6ACCD;">explain </span><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> ...;</span></span>
<span class="line"></span></code></pre></div><p><strong>如何使用索引？</strong></p><ol><li><p>方法1：在<code>create table</code>语句中指定索引列</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> Student;</span></span>
<span class="line"><span style="color:#676E95;">-- eg</span></span>
<span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">table</span><span style="color:#A6ACCD;"> Books</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">    bklD </span><span style="color:#F78C6C;">char</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">7</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">    bkName </span><span style="color:#F78C6C;">varchar</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">30</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">    bkAuthor </span><span style="color:#F78C6C;">varchar</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">30</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">    bkPrice </span><span style="color:#F78C6C;">int</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#A6ACCD;">#创建索引</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">index</span><span style="color:#A6ACCD;">(bkName)</span></span>
<span class="line"><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#676E95;">-- 查看Books表的定义</span></span>
<span class="line"><span style="color:#A6ACCD;">show </span><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">table</span><span style="color:#A6ACCD;"> Books;</span></span>
<span class="line"><span style="color:#676E95;">-- 查看索引</span></span>
<span class="line"><span style="color:#A6ACCD;">show </span><span style="color:#F78C6C;">index</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> Books;</span></span>
<span class="line"></span></code></pre></div></li><li><p>方法2：使用<code>alter table</code> 语句中创建索引</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">table</span><span style="color:#A6ACCD;"> Books1</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">    bklD </span><span style="color:#F78C6C;">char</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">7</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">    bkName </span><span style="color:#F78C6C;">varchar</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">30</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">    bkAuthor </span><span style="color:#F78C6C;">varchar</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">30</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">    bkPrice </span><span style="color:#F78C6C;">int</span></span>
<span class="line"><span style="color:#A6ACCD;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">-- 查看索引</span></span>
<span class="line"><span style="color:#A6ACCD;">show </span><span style="color:#F78C6C;">index</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> Books1;</span></span>
<span class="line"><span style="color:#F78C6C;">alter</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">table</span><span style="color:#A6ACCD;"> Books1 </span><span style="color:#F78C6C;">add</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">index</span><span style="color:#A6ACCD;"> idx_bkName(bkName </span><span style="color:#F78C6C;">desc</span><span style="color:#A6ACCD;">);</span><span style="color:#676E95;">-- 普通索引</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">-- 删除索引</span></span>
<span class="line"><span style="color:#F78C6C;">drop</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">index</span><span style="color:#A6ACCD;"> idx_bkName </span><span style="color:#F78C6C;">on</span><span style="color:#A6ACCD;"> Books1;</span></span>
<span class="line"><span style="color:#F78C6C;">alter</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">table</span><span style="color:#A6ACCD;"> Books1 </span><span style="color:#F78C6C;">add</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">unique</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">index</span><span style="color:#A6ACCD;"> idx_bkName(bkName </span><span style="color:#F78C6C;">desc</span><span style="color:#A6ACCD;">);</span><span style="color:#676E95;">-- 唯一索引</span></span>
<span class="line"><span style="color:#A6ACCD;">show </span><span style="color:#F78C6C;">index</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> Books1;</span></span>
<span class="line"></span></code></pre></div></li><li><p>方法3：使用<code>create index</code>语句中创建索引</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> [unique] </span><span style="color:#F78C6C;">index</span><span style="color:#A6ACCD;"> 索引名 </span><span style="color:#F78C6C;">on</span><span style="color:#A6ACCD;"> 表名(字段1[desc|asc],字段2[desc|asc]...)</span></span>
<span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">table</span><span style="color:#A6ACCD;"> Books2</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">    bklD </span><span style="color:#F78C6C;">char</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">7</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">    bkName </span><span style="color:#F78C6C;">varchar</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">30</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">    bkAuthor </span><span style="color:#F78C6C;">varchar</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">30</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">    bkPrice </span><span style="color:#F78C6C;">int</span></span>
<span class="line"><span style="color:#A6ACCD;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">-- 创建索引</span></span>
<span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">unique</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">index</span><span style="color:#A6ACCD;"> idx_NameAuthor </span><span style="color:#F78C6C;">on</span><span style="color:#A6ACCD;"> Books2(bkName </span><span style="color:#F78C6C;">asc</span><span style="color:#A6ACCD;">,bkAuthor </span><span style="color:#F78C6C;">desc</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#676E95;">-- 查看索引</span></span>
<span class="line"><span style="color:#A6ACCD;">show </span><span style="color:#F78C6C;">index</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> Books2;</span></span>
<span class="line"></span></code></pre></div></li></ol><h2 id="存储过程" tabindex="-1">存储过程 <a class="header-anchor" href="#存储过程" aria-hidden="true">#</a></h2><p>(1)什么是存储过程</p><blockquote><p>是一组完成特定功能的SQL语句，经过编译后保存在数据库中的。 用户可以通过存储过程名及参数值来调用存储过程。</p></blockquote><p>(2)为什么要使用存储过程？</p><blockquote><ol><li>模块化编程；</li><li>减少网络流量；</li><li>更快的执行速度；</li><li>提高数据的安全性</li></ol></blockquote><p>(3)如何使用存储过程？</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">procedure</span><span style="color:#A6ACCD;"> 存储过程名([in out inout]参数l数据类型（长度），…)</span></span>
<span class="line"><span style="color:#F78C6C;">begin</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#A6ACCD;"># 过程体；	</span></span>
<span class="line"><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">#</span><span style="color:#F78C6C;">in</span><span style="color:#A6ACCD;">:输入参数（默认）</span></span>
<span class="line"><span style="color:#A6ACCD;">#</span><span style="color:#F78C6C;">out</span><span style="color:#A6ACCD;">:输出参数</span></span>
<span class="line"><span style="color:#A6ACCD;">#inout:输入输出参数</span></span>
<span class="line"></span></code></pre></div><p>-eg:<em>不带参数的存储过程</em></p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">procedure</span><span style="color:#A6ACCD;"> usp_t1</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#F78C6C;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> Student </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> Sdept </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#676E95;">-- 调用存储过程</span></span>
<span class="line"><span style="color:#F78C6C;">call</span><span style="color:#A6ACCD;"> usp_t1</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><p>-eg:<em>带输入参数的存储过程</em></p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">drop</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">procedure</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">exists</span><span style="color:#A6ACCD;"> usp_t1;</span></span>
<span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">procedure</span><span style="color:#A6ACCD;"> usp_t1</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#F78C6C;">in</span><span style="color:#A6ACCD;"> vSdept </span><span style="color:#F78C6C;">char</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">), </span><span style="color:#676E95;">-- 输入参数，in可以省略</span></span>
<span class="line"><span style="color:#F78C6C;">in</span><span style="color:#A6ACCD;"> vSsex </span><span style="color:#F78C6C;">char</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">) </span><span style="color:#676E95;">-- 输入参数，in可以省略</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#F78C6C;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> Student </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> Sdept vSdept </span><span style="color:#F78C6C;">and</span><span style="color:#A6ACCD;"> Ssex vSsex;</span></span>
<span class="line"><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#676E95;">-- 调用存储过程</span></span>
<span class="line"><span style="color:#F78C6C;">call</span><span style="color:#A6ACCD;"> usp_t1(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cS</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">男</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)；</span></span>
<span class="line"><span style="color:#F78C6C;">call</span><span style="color:#A6ACCD;"> usp_t1(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">SE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">女</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)；</span></span>
<span class="line"></span></code></pre></div><p>eg:<em>带输入参数和输出参数的存储过程</em></p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#676E95;">-- 功能：输入学生的学号，从Stuent:表中删除该生，输出该生的姓名。</span></span>
<span class="line"><span style="color:#676E95;">-- 输入参数：学号</span></span>
<span class="line"><span style="color:#676E95;">-- 输出参数：姓名</span></span>
<span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">procedure</span><span style="color:#A6ACCD;"> usp_t2(</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">in</span><span style="color:#A6ACCD;"> vSno </span><span style="color:#F78C6C;">char</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">7</span><span style="color:#A6ACCD;">),</span><span style="color:#676E95;">-- 输入参数</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">out</span><span style="color:#A6ACCD;"> vSname </span><span style="color:#F78C6C;">varchar</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">)</span><span style="color:#676E95;">-- 输出参数</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#F78C6C;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> Sname </span><span style="color:#F78C6C;">into</span><span style="color:#A6ACCD;"> vSname </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> Student </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> Sno vSno;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">delete</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> Student </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> Sno vSno;</span></span>
<span class="line"><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#676E95;">-- 调用存储过程</span></span>
<span class="line"><span style="color:#676E95;">-- 通过用户变量@Sname来接收存储过程输出的值。</span></span>
<span class="line"><span style="color:#F78C6C;">call</span><span style="color:#A6ACCD;"> usp_t2(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2021007</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,@Sname);</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> @Sname;</span></span>
<span class="line"><span style="color:#F78C6C;">call</span><span style="color:#A6ACCD;"> usp_t2(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2021001</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,@Sname);</span></span>
<span class="line"><span style="color:#676E95;">-- 思考：修改过程体中的代码</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> student;</span></span>
<span class="line"></span></code></pre></div><h3 id="delimiter" tabindex="-1">delimiter <a class="header-anchor" href="#delimiter" aria-hidden="true">#</a></h3><blockquote><p>主要用命令行输入SQL语句时会用到。</p><p>用来修改结束符，以在命令中同时书写多个语句。</p></blockquote><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">procedure</span><span style="color:#A6ACCD;"> usp_t2(</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">in</span><span style="color:#A6ACCD;"> vSno </span><span style="color:#F78C6C;">char</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">7</span><span style="color:#A6ACCD;">),</span><span style="color:#676E95;">-- 输入参数</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">out</span><span style="color:#A6ACCD;"> vSname </span><span style="color:#F78C6C;">varchar</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">)</span><span style="color:#676E95;">-- 输出参数</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">delimiter $$</span></span>
<span class="line"><span style="color:#F78C6C;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> Sname </span><span style="color:#F78C6C;">into</span><span style="color:#A6ACCD;"> vSname </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> Student </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> Sno vSno;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">delete</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> Student </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> Sno vSno;</span></span>
<span class="line"><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;"> $$</span></span>
<span class="line"><span style="color:#A6ACCD;">delimiter ;</span></span>
<span class="line"></span></code></pre></div><h2 id="事件处理程序" tabindex="-1">事件处理程序 <a class="header-anchor" href="#事件处理程序" aria-hidden="true">#</a></h2><blockquote><p>保证程序在遇到错误的时候能够继续还行，避免程序异常而停止执行。</p></blockquote><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#676E95;">-- eg</span></span>
<span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">table</span><span style="color:#A6ACCD;"> test</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">    c1 </span><span style="color:#F78C6C;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">primary</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    c2 </span><span style="color:#F78C6C;">varchar</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;">-- create a stored procedure</span></span>
<span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">procedure</span><span style="color:#A6ACCD;"> usp_t4</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#F78C6C;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> @x </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">insert</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">into</span><span style="color:#A6ACCD;"> test </span><span style="color:#F78C6C;">values</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> @x </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">insert</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">into</span><span style="color:#A6ACCD;"> test </span><span style="color:#F78C6C;">values</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">world</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> @x </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#676E95;">-- call</span></span>
<span class="line"><span style="color:#F78C6C;">call</span><span style="color:#A6ACCD;"> usp_t4</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> @x;</span></span>
<span class="line"></span></code></pre></div><p>-MySQL的错误 mysql&gt;use TeachDB; Database changed mysql&gt;delete from tablel; ERROR 1146(42S02):Table &#39;teachdb.table1&#39;doesn&#39;t exist&#39; 两种方法来表示错误 整数类型的错误代码(mysql error code):如1146 长度为5的字符串类型的错误代码(sqlstate_value),如42S02 mysql&gt;insert into test values(1,&#39;world&#39;); ERROR 1062(23000):Duplicate entry &#39;1&#39;for key &#39;test.PRIMARY&#39; 整数类型的错误代码(mysql_error_.code)：1062</p><p>2、事件 create event 执行定时或周期性的任务；</p><h2 id="触发器" tabindex="-1">触发器 <a class="header-anchor" href="#触发器" aria-hidden="true">#</a></h2><blockquote><p><strong>什么是触发器</strong></p><p>触发器trigger,是由事件触发自动执行的一组完成特定功能的SQL语句。</p><p><strong>存储过程和触发器的区别</strong></p><p>存储过程中的这一组SQL语句：需要用户调用存储过程才执行。 触发器中的这一组SQL语句：由事件触发自动执行。</p></blockquote><p>事件：insert,update,delete</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#A6ACCD;">#</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">、如何使用触发器</span></span>
<span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> trigger 触发器名 {</span><span style="color:#F78C6C;">before</span><span style="color:#A6ACCD;">|</span><span style="color:#F78C6C;">after</span><span style="color:#A6ACCD;">}{</span><span style="color:#F78C6C;">insert</span><span style="color:#A6ACCD;">|</span><span style="color:#F78C6C;">update</span><span style="color:#A6ACCD;">|</span><span style="color:#F78C6C;">delete</span><span style="color:#A6ACCD;">} on表名</span></span>
<span class="line"><span style="color:#A6ACCD;">for each </span><span style="color:#F78C6C;">row</span></span>
<span class="line"><span style="color:#F78C6C;">begin</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#A6ACCD;">#一组SQL语句；</span></span>
<span class="line"><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#676E95;">-- 例：理解 before</span></span>
<span class="line"><span style="color:#F78C6C;">drop</span><span style="color:#A6ACCD;"> trigger </span><span style="color:#F78C6C;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">exists</span><span style="color:#A6ACCD;"> tri_t1;</span></span>
<span class="line"><span style="color:#A6ACCD;">delimiter </span><span style="color:#89DDFF;">//</span></span>
<span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> trigger tri_t1 </span><span style="color:#F78C6C;">before</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">insert</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">on</span><span style="color:#A6ACCD;"> Student</span></span>
<span class="line"><span style="color:#A6ACCD;">for each </span><span style="color:#F78C6C;">row</span></span>
<span class="line"><span style="color:#F78C6C;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Student表上的触发器执行啦!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">into</span><span style="color:#A6ACCD;"> @Msg;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">count</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">into</span><span style="color:#A6ACCD;"> @Count </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> Student;	</span></span>
<span class="line"><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">//</span></span>
<span class="line"><span style="color:#A6ACCD;">delimiter ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">-- 测试触发器</span></span>
<span class="line"><span style="color:#F78C6C;">insert</span><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">into</span><span style="color:#A6ACCD;"> Student </span><span style="color:#F78C6C;">values</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2017007</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">王五</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">男</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">20</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> @Msg, @Count;  </span></span>
<span class="line"><span style="color:#F78C6C;">insert</span><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">into</span><span style="color:#A6ACCD;"> Student </span><span style="color:#F78C6C;">values</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2017005</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">王五</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">男</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">20</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> @Msg, @Count;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">drop</span><span style="color:#A6ACCD;"> trigger </span><span style="color:#F78C6C;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">exists</span><span style="color:#A6ACCD;"> tri_t1;</span></span>
<span class="line"><span style="color:#A6ACCD;">delimiter </span><span style="color:#89DDFF;">//</span></span>
<span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> trigger tri_t1 </span><span style="color:#F78C6C;">after</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">delete</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">on</span><span style="color:#A6ACCD;"> Student</span></span>
<span class="line"><span style="color:#A6ACCD;">for each </span><span style="color:#F78C6C;">row</span></span>
<span class="line"><span style="color:#F78C6C;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Student表上的触发器执行啦!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">into</span><span style="color:#A6ACCD;"> @Msg;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">count</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">into</span><span style="color:#A6ACCD;"> @Count </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> Student;	</span></span>
<span class="line"><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">//</span></span>
<span class="line"><span style="color:#A6ACCD;">delimiter ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">-- 测试触发器</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> @Msg, @Count;</span></span>
<span class="line"><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> @Msg </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">null</span><span style="color:#A6ACCD;">, @Count </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> @Msg, @Count;</span></span>
<span class="line"><span style="color:#F78C6C;">delete</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> Student </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> Sno </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2017005</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> @Msg, @Count;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">drop</span><span style="color:#A6ACCD;"> trigger </span><span style="color:#F78C6C;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">exists</span><span style="color:#A6ACCD;"> tri_t1;</span></span>
<span class="line"><span style="color:#A6ACCD;">delimiter </span><span style="color:#89DDFF;">//</span></span>
<span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> trigger tri_t1 </span><span style="color:#F78C6C;">after</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">insert</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">on</span><span style="color:#A6ACCD;"> Student</span></span>
<span class="line"><span style="color:#A6ACCD;">for each </span><span style="color:#F78C6C;">row</span></span>
<span class="line"><span style="color:#F78C6C;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">	 </span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> @Sno </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> new.Sno, @Sname </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> new.Sname, </span></span>
<span class="line"><span style="color:#A6ACCD;">	     @Ssex </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> new.Ssex, @Sage </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> new.Sage, @Sdept </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> new.Sdep;</span></span>
<span class="line"><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">//</span></span>
<span class="line"><span style="color:#A6ACCD;">delimiter ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">-- 测试触发器</span></span>
<span class="line"><span style="color:#F78C6C;">insert</span><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">into</span><span style="color:#A6ACCD;"> Student </span><span style="color:#F78C6C;">values</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2017005</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">王五</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">男</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">20</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> @Sno, @Sname, @Ssex, @Sage, @Sdept;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">drop</span><span style="color:#A6ACCD;"> trigger </span><span style="color:#F78C6C;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">exists</span><span style="color:#A6ACCD;"> tri_t1;</span></span>
<span class="line"><span style="color:#A6ACCD;">delimiter </span><span style="color:#89DDFF;">//</span></span>
<span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> trigger tri_t1 </span><span style="color:#F78C6C;">before</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">update</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">on</span><span style="color:#A6ACCD;"> Student</span></span>
<span class="line"><span style="color:#A6ACCD;">for each </span><span style="color:#F78C6C;">row</span></span>
<span class="line"><span style="color:#F78C6C;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">	 </span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> @Sno1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> new.Sno, @Sname1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> new.Sname, </span></span>
<span class="line"><span style="color:#A6ACCD;">	     @Ssex1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> new.Ssex, @Sage1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> new.Sage, @Sdept1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> new.Sdep;</span></span>
<span class="line"><span style="color:#A6ACCD;">	 </span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> @Sno2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> old.Sno, @Sname2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> old.Sname, </span></span>
<span class="line"><span style="color:#A6ACCD;">	     @Ssex2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> old.Ssex, @Sage2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> old.Sage, @Sdept2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> old.Sdep;		 </span></span>
<span class="line"><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">//</span></span>
<span class="line"><span style="color:#A6ACCD;">delimiter ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">update</span><span style="color:#A6ACCD;"> Student </span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> Sname </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">王六</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, Ssex </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">女</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, Sage </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">18</span><span style="color:#A6ACCD;">, Sdep </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">EN</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> Sno </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2017005</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> @Sno1, @Sname1, @Ssex1, @Sage1, @Sdept1;</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> @Sno2, @Sname2, @Ssex2, @Sage2, @Sdept2;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">drop</span><span style="color:#A6ACCD;"> trigger </span><span style="color:#F78C6C;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">exists</span><span style="color:#A6ACCD;"> tri_t1;</span></span>
<span class="line"><span style="color:#A6ACCD;">delimiter </span><span style="color:#89DDFF;">//</span></span>
<span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> trigger tri_t1 </span><span style="color:#F78C6C;">after</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">update</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">on</span><span style="color:#A6ACCD;"> SC</span></span>
<span class="line"><span style="color:#A6ACCD;">for each </span><span style="color:#F78C6C;">row</span></span>
<span class="line"><span style="color:#F78C6C;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> @Count </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> @Count </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">;			 </span></span>
<span class="line"><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">//</span></span>
<span class="line"><span style="color:#A6ACCD;">delimiter ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">-- 测试触发器</span></span>
<span class="line"><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> @Count </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#F78C6C;">update</span><span style="color:#A6ACCD;"> SC </span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> Grade </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Grade </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> @Count;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">drop</span><span style="color:#A6ACCD;"> trigger </span><span style="color:#F78C6C;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">exists</span><span style="color:#A6ACCD;"> avgTriggle;</span></span>
<span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> trigger avgTriggle </span><span style="color:#F78C6C;">after</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">insert</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">on</span><span style="color:#A6ACCD;"> sc</span></span>
<span class="line"><span style="color:#A6ACCD;">for each </span><span style="color:#F78C6C;">row</span></span>
<span class="line"><span style="color:#F78C6C;">begin</span></span>
<span class="line"><span style="color:#F78C6C;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">exists</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> avgTable </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> Sno</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">New.Sno) </span><span style="color:#F78C6C;">then</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#F78C6C;">update</span><span style="color:#A6ACCD;"> avgTable</span></span>
<span class="line"><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> avgGrade</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">avg</span><span style="color:#A6ACCD;">(Grade) </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> Sc </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> Sno</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">New.Sno)</span></span>
<span class="line"><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> Sno</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">New.Sno ;</span></span>
<span class="line"><span style="color:#F78C6C;">else</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#F78C6C;">insert</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">into</span><span style="color:#A6ACCD;"> avgtable </span><span style="color:#F78C6C;">values</span><span style="color:#A6ACCD;"> (New.Sno,New.Grade); </span></span>
<span class="line"><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">if</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#F78C6C;">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> sc;</span></span>
<span class="line"><span style="color:#F78C6C;">drop</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">table</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">exists</span><span style="color:#A6ACCD;"> avgTable;</span></span>
<span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">table</span><span style="color:#A6ACCD;"> avgTable </span><span style="color:#F78C6C;">as</span></span>
<span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;">  Sno ,</span><span style="color:#82AAFF;">avg</span><span style="color:#A6ACCD;">(Grade)  avgGrade </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> Sc </span><span style="color:#F78C6C;">group by</span><span style="color:#A6ACCD;"> Sno ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> TRIGGER AP </span><span style="color:#F78C6C;">AFTER</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">INSERT</span></span>
<span class="line"><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> SC FOR EACH </span><span style="color:#F78C6C;">ROW</span></span>
<span class="line"><span style="color:#82AAFF;">REPLACE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">INTO</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AVG</span><span style="color:#A6ACCD;">(Sno,avgGrade) </span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> Sno,</span><span style="color:#82AAFF;">AVG</span><span style="color:#A6ACCD;">(Grade) </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> SC </span><span style="color:#F78C6C;">GROUP BY</span><span style="color:#A6ACCD;"> Sno;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h2 id="游标" tabindex="-1">游标 <a class="header-anchor" href="#游标" aria-hidden="true">#</a></h2><blockquote><p>名称是cursor，与一条select关联。</p><p>游标由select语句得到的查询结果集和指向结果集中特定记录的位置指针组成。 <code>select Sno,Sname,Sage from Student;</code></p><p>好处：通过游标可以==逐行地读取==select查询结果集中的记录。</p></blockquote><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre><code><span class="line"><span style="color:#F78C6C;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">procedure</span><span style="color:#A6ACCD;"> usp_cursor</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#F78C6C;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">declare</span><span style="color:#A6ACCD;"> done </span><span style="color:#F78C6C;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">declare</span><span style="color:#A6ACCD;"> vSno </span><span style="color:#F78C6C;">char</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">7</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">declare</span><span style="color:#A6ACCD;"> vSname </span><span style="color:#F78C6C;">varchar</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">20</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">declare</span><span style="color:#A6ACCD;"> vSage </span><span style="color:#F78C6C;">int</span><span style="color:#A6ACCD;">;</span><span style="color:#676E95;">-- 声明变量</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">-- 1.声明游标</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">declare</span><span style="color:#A6ACCD;"> curStudent </span><span style="color:#F78C6C;">cursor</span><span style="color:#A6ACCD;"> for </span><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> sno,sname,sage </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> student;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">declare</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">continue</span><span style="color:#A6ACCD;"> handler for </span><span style="color:#F78C6C;">not</span><span style="color:#A6ACCD;"> found </span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> done</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">-- 2.打开游标</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">open</span><span style="color:#A6ACCD;"> curStudent;</span></span>
<span class="line"><span style="color:#A6ACCD;">    label1:</span><span style="color:#F78C6C;">loop</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">-- 3.使用游标</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F78C6C;">fetch</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">next</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> curStudent </span><span style="color:#F78C6C;">into</span><span style="color:#A6ACCD;"> vSno,vSname,vSage;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F78C6C;">if</span><span style="color:#A6ACCD;"> done </span><span style="color:#F78C6C;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">            leave label1;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">if</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">concat</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">学号</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,vSno,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">姓名</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,vSname,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">年龄</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,vSage);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">loop</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">-- 4.关闭游标</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">close</span><span style="color:#A6ACCD;"> curStudent;</span></span>
<span class="line"><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#676E95;">-- 调用</span></span>
<span class="line"><span style="color:#F78C6C;">call</span><span style="color:#A6ACCD;"> usp_cursor</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="事务" tabindex="-1">事务 <a class="header-anchor" href="#事务" aria-hidden="true">#</a></h2><blockquote></blockquote><p>-- 执行查询语句，查看查询操作是否使用了索引 explain select<em>from Books2 where bkName=&#39;数据库原理及应用&#39;; explain select</em>from Books2 where bkPrice&gt;50;</p><p>思考：什么样的查询操作不会使用索引？</p><p>-- 系统会自动在主键列或唯一列上创建索引 show index from Student;</p><p><img src="/frontend-blog/assets/5TVJ.d3dad751.png" alt="img"></p><p>难道&lt;&gt;all是和&lt;&gt;some等价吗？</p><p>-- 查询每门课都及格的学生</p></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-37ebe389 data-v-a54a85bd><!----><div class="prev-next" data-v-a54a85bd><div class="pager" data-v-a54a85bd><!----></div><div class="pager" data-v-a54a85bd><a class="pager-link next" href="/frontend-blog/pages/computer-knowledge-stack/algorithm/complexity/" data-v-a54a85bd><span class="desc" data-v-a54a85bd>Next page</span><span class="title" data-v-a54a85bd>算法理论</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"f8c9e948\",\"pages_computer-knowledge-stack_algorithm_complexity_index.md\":\"f35aae88\",\"pages_computer-knowledge-stack_algorithm_ds_index.md\":\"31dd9f85\",\"pages_computer-knowledge-stack_algorithm_main_index.md\":\"f06f5580\",\"pages_computer-knowledge-stack_algorithm_others_index.md\":\"1968d138\",\"pages_computer-knowledge-stack_algorithm_sorting_index.md\":\"8062844e\",\"pages_computer-knowledge-stack_browser_index.md\":\"7c51a31d\",\"pages_computer-knowledge-stack_index.md\":\"f422a8ad\",\"pages_computer-knowledge-stack_network_index.md\":\"ef375fa8\",\"pages_computer-knowledge-stack_sql_advanced_index.md\":\"7c5346ea\",\"pages_computer-knowledge-stack_sql_basic_index.md\":\"288085af\",\"pages_front-end-application_index.md\":\"80120522\",\"pages_front-end-application_mini-program_wx_index.md\":\"72614285\",\"pages_front-end-application_nodejs_basic_index.md\":\"a3fae4c8\",\"pages_front-end-application_nodejs_frameworks_index.md\":\"f7a2afe9\",\"pages_front-end-application_react_basic_index.md\":\"daf587be\",\"pages_front-end-application_react_jsx_index.md\":\"9476eea7\",\"pages_front-end-application_typescript_basic_index.md\":\"fea1f1c4\",\"pages_front-end-application_visual_d3_index.md\":\"fbd73ae9\",\"pages_front-end-application_visual_echarts_index.md\":\"28a18bcb\",\"pages_front-end-application_vue_how-it-works_index.md\":\"68c80f55\",\"pages_front-end-application_vue_pinia_index.md\":\"3ffd8606\",\"pages_front-end-application_vue_v2-features_index.md\":\"fe758f74\",\"pages_front-end-application_vue_v3-features_index.md\":\"d0e2a7a7\",\"pages_front-end-application_vue_vue-projects_index.md\":\"ebed2761\",\"pages_front-end-application_vue_vue-router_index.md\":\"cfa323cf\",\"pages_front-end-application_vue_vuex_index.md\":\"ee441616\",\"pages_front-end-stack_async-js_index.md\":\"85c8249f\",\"pages_front-end-stack_css-advanced_index.md\":\"2e3022e5\",\"pages_front-end-stack_css-basic_index.md\":\"4b500e3e\",\"pages_front-end-stack_css-bootstrap_index.md\":\"c429dfef\",\"pages_front-end-stack_css-miscellaneous_index.md\":\"6b2fc863\",\"pages_front-end-stack_emmet_index.md\":\"d6718ecc\",\"pages_front-end-stack_es6-onwards-dex_index.md\":\"b5d8c125\",\"pages_front-end-stack_html-canvas_index.md\":\"eb955fe6\",\"pages_front-end-stack_html-common_index.md\":\"f8811684\",\"pages_front-end-stack_html-semantics_index.md\":\"0de8fe94\",\"pages_front-end-stack_index.md\":\"9ba7433b\",\"pages_front-end-stack_jquery_index.md\":\"651668e2\",\"pages_front-end-stack_js-advanced_index.md\":\"32dc6c90\",\"pages_front-end-stack_js-basic_index.md\":\"c8a3a99a\",\"pages_front-end-stack_js-files_index.md\":\"f996e4de\",\"pages_front-end-stack_js-request_index.md\":\"39494a94\",\"pages_front-end-stack_less-sass_index.md\":\"996ec26d\",\"pages_front-end-stack_svg_index.md\":\"366ba047\",\"pages_thoughts_index.md\":\"20a97a93\",\"pages_useful_batch_index.md\":\"9beadea8\",\"pages_useful_index.md\":\"0b66086c\",\"pages_useful_snippets_index.md\":\"058ccaf9\"}")</script>
    <script type="module" async src="/frontend-blog/assets/app.d773c0a6.js"></script>
    
  </body>
</html>